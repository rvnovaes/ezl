{% extends 'base.html' %}
<!-- TODO: verificar se este arquivo pode ser excluido com novo template -->
{% load staticfiles %}

{% block css_head %}
    {{ block.super }}
    {% if object %}
        {% include 'ecm/styles.html' %}
    {% endif %}
    {% if is_popup %}
        <style type="text/css">
            .navbar{
                display: none;
            }
            .content-block{
                margin-top: 1em;
            }
        </style>
    {% endif %}

{% endblock %}

{% block body %}
    {% if user.is_authenticated %}
        <div class="navbar navbar-default navbar-fixed-top">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse"
                            data-target=".navbar-responsive-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="{% url 'dashboard' %}">EZL</a>
                </div>
                <div class="navbar-collapse collapse navbar-responsive-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="{% url 'dashboard' %}">Dashboard</a></li>
                        <li><a href="{% url 'task_search' %}">Pesquisar</a></li>
                        {% if perms.core.can_access_general_data %}
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle"
                                   data-toggle="dropdown" role="button"
                                   aria-haspopup="true" aria-expanded="false">Cadastros<span
                                        class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    <li><a href="{% url 'costcenter_list' %} "target="_self">Centros de Custos</a></li>
                                    <li><a href="{% url 'courtdistrict_list' %} "target="_self">Comarcas</a></li>
                                    <li><a href="{% url 'office_list' %} "target="_self">Escritórios</a></li>
                                    <li><a href="{% url 'instance_list' %}" target="_self">Instâncias</a></li>
                                    <li><a href="{% url 'organ_list' %}" target="_self">Órgãos</a></li>
                                    <li><a href="{% url 'folder_list' %}" target="_self">Pastas</a></li>
                                    <li><a href="{% url 'person_list' %}" target="_self">Pessoas</a></li>
                                    <li><a href="{% url 'type_movement_list' %}" target="_self">Tipos de Movimentação</a></li>
                                    <li><a href="{% url 'servicepricetable_list' %}" target="_self">Tabela de preços dos serviços</a></li>
                                    <li><a href="{% url 'courtdivision_list' %}" target="_self">Varas</a></li>
                                </ul>
                            </li>
                        {% endif %}
                        {% if perms.core.can_access_general_data %}
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle"
                                   data-toggle="dropdown" role="button"
                                   aria-haspopup="true" aria-expanded="false">Administração<span
                                        class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    {% if perms.core.can_edit_surveys %}
                                        <li><a href="{% url 'survey_list' %} "target="_self">Pesquisas</a></li>
                                    {% endif %}
                                    <li><a href="{% url 'ecm:defaultattachmentrule_list' %}" target="_self">Regras de Anexos</a></li>
                                    <li><a href="{% url 'user_list' %}" target="_self">Usuários</a></li>
                                </ul>
                            </li>
                        {% endif %}
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle"
                               data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false">Ajuda<span
                                    class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="{% url 'user_manual' %}" target="_blank">Manual do Usuário</a></li>
                                <li><a href="#modal1"  onclick="modal('about_modal', '{% static "js/jquery-2.1.1.min.js" %}')">Sobre</a></li>
                                <li><a href="http://suporte.ezlawyer.com.br/otrs/customer.pl" target="_blank">Suporte</a></li>
                            </ul>
                        </li>
                        <li class="open"><a href="{% url 'task_add' %}">Criar OS</a></li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="/chat" data-balloon="Clique para ver suas mensagens!"
                               data-balloon-pos="down">
                                <i class="fa fa-1x fa-commenting" aria-hidden="true">
                                    <span class="chat-badge badge"></span>
                                </i>
                            </a>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                               aria-haspopup="true" aria-expanded="false">
                               <span id="current_office"></span>
                               <span class="caret"></span>
                           </a>
                           <ul class="dropdown-menu">
                            {% for office in request.user.person.offices.active_offices %}
                                <li onclick="updateSession('current_office', '{{office.pk}}', '{{csrf_token}}');"><a href="#">{{office.name}}</a></li>
                            {% endfor %}
                           </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                    {# Utilizado request.user.username pelo para nao alterar o nome do usuario logado #}
                               aria-haspopup="true" aria-expanded="false">{{ request.user.username }} <span
                                    class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="{% url 'filter_list' %}">Gerenciar Filtros</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="{% url 'start_user' %}">Meu perfil</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="#modal1"
                                       onclick="modal('logout_modal', '{% static "js/jquery-2.1.1.min.js" %}')">Sair do
                                    Sistema</a>
                                </li>
                            </ul>
                        </li>

                    </ul>
                </div>
            </div>
        </div>

        <div class="content-block">
            {% block content %}
                {% include 'core/widgets/messages.html' %}
            {% endblock content %}
            {% block attachment %}
                {% if object %}
                    {% include 'ecm/attachments.html' %}
                {% endif %}
            {% endblock attachment %}
        </div>

        <!-- Janela modal de logout -->
        <div class="modal" id="logout_modal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title">Logout</h4>
                    </div>
                    <div class="modal-body">
                        <p>Tem certeza que deseja sair do sistema?</p>
                    </div>
                    <div class="modal-footer">
                        <form action="{% url 'logout' %}">
                            <input type="submit" class="btn btn-raised btn-danger" data-dismiss="modal"
                                   value="Cancelar" style="float: unset;margin: 10px 1px;"/>
                            <input type="submit" class="btn btn-raised btn-primary" value="Sair"
                                   style="margin: 10px 1px !important;"/>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Janela modal de sobre -->
        <div class="modal" id="about_modal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title">Sobre</h4>
                    </div>
                    <div class="modal-body">
                        <p><img src="{% static "img/logo_ezl.png" %}" height="30"/></p>
                        <p>Versão: 1.2.2</p>
                        <p>&copy; Copyright {% now "Y" %} EZLawyer. Todos os direitos reservados.</p>
                        <p>Compatibilidade com os navegadores:
                            <ul>
                                <li>Chrome 62.0 (ou superior)</li>
                                <li>Firefox 47.0 (ou superior)</li>
                                <li>Opera 49.0 (ou superior)</li>
                                <li>Safari 11.0 (ou superior)</li>
                            </ul>
                        <br>
                        <p>Desenvolvido por: <img onclick="window.open('http://www.ezlawyer.com.br/')"
                            src="{% static "img/logo.png" %}" height="20" style="cursor: pointer; cursor: hand;"/>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <!-- TODO: Se não for usar quando não tiver usuário logado, remover o else  -->.
    {% endif %}
{% endblock %}

{% block extrajs %}
    {% if object %}
        {% include 'ecm/javascripts.html' %}
    {% endif %}
{% endblock %}
