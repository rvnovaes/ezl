<script>
    var tmplRowUpload = '<tr class="zoomInDown animated">\n' +
                        '    <td style="width: 50px;">\n' +
                        '       <div class="circle circle-sm bg-info di"> <i class="fa fa-user"></i></div>\n' +
                        '    </td>\n' +
                        '    <td>\n' +
                        '       <span class="font-bold">${user}</span><br>\n' +
                        '       <small class="text-muted">${data}</small>\n' +
                        '    </td>\n' +
                        '    <td class="text-left">\n' +
                        '       <h4><i class="fa fa-file-o"></i> ${filename}</h4>\n' +
                        '    </td>\n' +
                        '    <td class="text-right">\n' +
                        '       <button onclick="window.open(\'/media/${url}\', \'_new\')" data-toggle="tooltip" title="Baixar arquivo"  type="button" class="btn btn-info btn-outline btn-circle btn-sm m-r-5"><i class="icon-cloud-download"></i></button>\n' +
                        '       <button onclick="deleteFile(\'${model_name}\', ${object_id},  ${pk}, \'${filename}\')" data-toggle="modal" type="button" class="btn btn-danger btn-outline btn-circle btn-sm m-r-5"\n' +
                        '               data-type="deleteFile" data-pk="${pk}" data-filename="${filename}">\n' +
                        '           <i class="icon-trash"></i>\n' +
                        '       </button>\n'+
                        '    </td>\n' +
                        '</tr>';

    function get_attachments(model_name, object_id) {
        $.ajax({
            url: "/ecm/ajax_get_attachments/",
            data: {
                'object_id': object_id,
                'model_name': model_name
            },
            dataType: 'json',
            success: function (data) {
                $('#containnerUploads').html('');
                $('#totalAttachments').html('(' + data.total_records + ')')
                if (data.total_records) {
                    $('#no-data').addClass('hide')
                } else {
                    $('#no-data').removeClass('show')
                };
                $.each(data.files, function( index, value ) {
                    console.log("AQUI")
                    $.tmpl(tmplRowUpload, value).appendTo('#containnerUploads');
                })
            }
        });
    }

    function deleteFile(model_name, object_id, pk, file) {
        swal({
            title: file,
            text: "Deseja excluir o Arquivo?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Sim, Excluir Arquivo!",
            cancelButtonText: "Cancelar",
            closeOnConfirm: false
        }, function(){
            $('#deleting').modal('show');
            $.ajax({
                url: '/ecm/ajax-drop-attachment/' + pk,
                dataType: 'json',

                success: function (data) {
                    if (data.is_deleted) {
                        $('#deleting').modal('hide');
                        get_attachments(model_name, object_id);
                        swal("Sucesso", data.message, "success")
                    }
                    else {
                        $('#deleting').modal('hide');
                        swal("Erro", data.message, "error")
                    }
                }
            })
        });
    }
</script>