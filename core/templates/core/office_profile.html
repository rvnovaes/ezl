{% extends 'skeleton/base.html' %}
{% load render_table from django_tables2 %}
{% load static %}
{% load querystring from django_tables2 %}
{% load bootstrap3 %}
{% load core_filters core_match %}
{%block content%}
{% block page_title %}

{% endblock %}
<div class="profile">
    <div class="profile-heading">
    </div>
    <div class="profile-data">
        <div class="profile-about">
        	<div class="white-box custom-white-box">
                <div class="pull-right">
                    {% if 'group_admin' in office_session_perms and is_session_office %}
                        <button class="btn btn-sm btn-success" id="btn-edit-office"> <i class="fa fa-pencil"></i> Editar</button>       
                    {% endif %}
                </div>                
        		<div class="row">
        			<div class="col-md-2">
        				<div class="profile-logo">
                            {% if office.logo %}
                                <img id="logo" src="{{office.logo.url}}">
                            {% endif %}        					
        				</div>
        			</div>
        			<div class="col-md-8">
                        <div>
                            <h3>
                                <span id="el-office-legal-name"></span>
                                <br/>                            
                            </h3>                        
                        </div>
        				<hr/>   	
                        <i class="fa fa-file-o" aria-hidden="true"></i> <span id="el-office-cpf-cnpj"></span><br>
                        {% for address in office.address_set.all %}	                                             
                            <span><i class="fa fa-map-marker" aria-hidden="true"></i> {{address.city}}, {{address.state}}</span><br>
                        {%endfor%}
                        {% for contact in office.contactmechanism_set.all %}              
                            {% if contact.contact_mechanism_type.name == 'Telefone'%}                                
                                <span><i class="fa fa-phone" aria-hidden="true"></i> {{contact}}</span><br/>
                            {% endif %}
                        {%endfor%}                        				
                        {% for contact in office.contactmechanism_set.all %}
                            {% if contact.contact_mechanism_type.name == 'E-mail' %}
                                <span><i class="fa fa-envelope-o" aria-hidden="true"></i> <a href="{{contact}}">{{contact}}</a></span>
                            {%endif%}
                        {%endfor%}                                          				    				
        			</div>
        		</div>
        	</div>
        </div>    
        <div class="row">
            <div class="col-md-12">
                <div class="white-box custom-white-box bg-info m-b-0 p-b-0 mailbox-widget ezl-panel" id="more-info">                    
                    <ul class="nav customtab nav-tabs" role="tablist">
                        <li role="presentation" class="active"><a href="#tab-about" aria-controls="home" role="tab" data-toggle="tab" aria-expanded="true"><span class="visible-xs"><i class="ti-email"></i></span><span class="hidden-xs"> Sobre</span></a></li>
                        {% if 'group_admin' in office_session_perms and is_session_office %}
                            <li role="presentation" class=""><a href="#tab-areas-of-expertise" aria-controls="settings" role="tab" data-toggle="tab" aria-expanded="false"><span class="visible-xs"><i class="ti-email"></i></span><span class="hidden-xs"> Áreas de atuação</span></a></li>
                        {% endif %}
                        <li role="presentation" class=""><a href="#tab-address" aria-controls="profile" role="tab" data-toggle="tab" aria-expanded="false"><span class="visible-xs"><i class="ti-export"></i></span> <span class="hidden-xs">Endereço</span></a></li>
                        <li role="presentation" class=""><a href="#tab-mechanism-contact" aria-controls="settings" role="tab" data-toggle="tab" aria-expanded="false"><span class="visible-xs"><i class="ti-trash"></i></span> <span class="hidden-xs">Contato</span></a></li>
                        {% if 'group_admin' in office_session_perms and is_session_office %}
                            <li role="presentation" class=""><a href="#tab-invite-users" aria-controls="settings" role="tab" data-toggle="tab" aria-expanded="false"><span class="visible-xs"><i class="ti-trash"></i></span> <span class="hidden-xs">Usuários</span></a></li>
                            <li role="presentation" class=""><a href="#tab-invite-office" aria-controls="settings" role="tab" data-toggle="tab" aria-expanded="false"><span class="visible-xs"><i class="ti-trash"></i></span> <span class="hidden-xs">Escritórios</span></a></li>
                            <li role="presentation" class=""><a href="#tab-billign-details" aria-controls="settings" role="tab" data-toggle="tab" aria-expanded="false"><span class="visible-xs"><i class="ti-trash"></i></span> <span class="hidden-xs">Detalhes de cobrança</span></a></li>
                        {% endif %}
                    </ul>
                </div>
                <div class="white-box custom-white-box p-0">
                    <div class="tab-content m-t-0 p-b-30">
                        <div role="tabpanel" class="tab-pane fade active in" id="tab-about">
                            <div class="row">
                                <div class="col col-md-4">
                                    <div class="p-10">
                                        <h3>Estados em que atua</h3>
                                    </div>
                                    <ul>
                                        {% for state in office.states_of_practice %}
                                        <div class="col col-md-6">
                                            <li>{{state}}</li>
                                        </div>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <div class="col col-md-4">
                                    <div class="p-10">
                                        <h3>Áreas em que atua</h3>
                                    </div>
                                    <ul id="office-areas-of-expertise">
                                        {% for area in office.areaofexpertise_set.all %}
                                        <div class="col col-md-12" style="margin: 3px">
                                            <li>{{area.area}}</li>
                                        </div>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <div class="col col-md-4">
                                    <div class="p-10">
                                        <h3>Serviços que executa</h3>
                                    </div>
                                    <ul>
                                        {% for service in office.type_of_service %}
                                        <div class="col col-md-12" style="margin: 3px">
                                            <li>{{service}}</li>
                                        </div>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                        {% if 'group_admin' in office_session_perms and is_session_office %}
                            <div role="tabpanel" class="tab-pane fade" id="tab-areas-of-expertise">
                            <div class="col-md-12">
								<div class="p-20 row">
	                                <div class="col-sm-6">
	                                    <h3 class="m-t-0">Áreas de atuação</h3>
	                                </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="areas-of-expertise">
                                            <div class="table-responsive">
                                            <form id="form-areas-expertise">
                                                <table class="table table-striped table-hover" id="areas-of-expertise-table">
                                                    <tr>
                                                        <th style="width: 10px;">&nbsp;</th>
                                                        <th>Área de atuação</th>
                                                    </tr>
                                                    {% for area in areas_expertise %}
                                                        <tr>
                                                            <td><input name="area_{{ area.id }}"
                                                                       id="id_area_{{ area.id }}"
                                                                       type="checkbox"
                                                                       value="{{ area.id }}"
                                                                       {% if area.total_office > 0 %}checked{% endif %}></td>
                                                            <td id="area_text_{{ area.id }}"
                                                                data-id="{{ area.id }}">{{ area.area }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </table>
                                            </form>
                                            </div>
                                            <div class="text-right btn-table-actions">
                                                <div class="text-right" style="">
                                                    <div class="fixed-btn">
                                                        <button class="btn btn-success" id="btn-add-areas">
                                                            Salvar</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        {% endif %}
                        <div role="tabpanel" class="tab-pane fade" id="tab-address">
                            <div class="col-md-12">
								<div class="p-20 row">
	                                <div class="col-sm-6">
	                                    <h3 class="m-t-0">Endereços do escritório</h3>
	                                </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="address">
                                            <div id="endereco">                                                
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-hover" paginate-fixed id="address-table">
                                                        {% block table.thead %}
                                                        <thead>
                                                            <tr>
                                                                {% for column in table.columns %} {% if column.orderable %}
                                                                <th {{ column.attrs.th.as_html }}><a href="{% querystring table.prefixed_order_by_field=column.order_by_alias.next %}">{{ column.header|lower|capfirst }}</a>
                                                                </th>
                                                                {% else %} {% if not column.attrs.selectable == True %}
                                                                <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                                                {% else %}
                                                                <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                                                {% endif %} {% endif %} {% endfor %}
                                                            </tr>
                                                        </thead>
                                                        {% endblock table.thead %} {% block table.tbody %}
                                                        <tbody>
                                                            {% for row in table.page.object_list|default:table.rows %} {% block table.tbody.row %}
                                                            <tr class="{% cycle " odd " "even " %}" id="{{ row.attrs.pk }}" pk="{{ row.attrs.pk }}">
                                                                {% for column, cell in row.items %}
                                                                <td {{ column.attrs.td.as_html }}>{{ cell }}</td>
                                                                {% endfor %}
                                                            </tr>
                                                            {% endblock table.tbody.row %} {% empty %} {% if table.empty_text %} {% block table.tbody.empty_text %}
                                                            <tr>
                                                                <td colspan="{{ table.columns|length }}">{{ table.empty_text }}</td>
                                                            </tr>
                                                            {% endblock table.tbody.empty_text %} {% endif %} {% endfor %}
                                                        </tbody>
                                                        {% endblock table.tbody %} {% block table.tfoot %}
                                                        <tfoot></tfoot>
                                                        {% endblock table.tfoot %}
                                                    </table>
                                                </div>
                                                {% if 'group_admin' in office_session_perms and is_session_office %}
                                                    <div class="text-right btn-table-actions">
                                                        <div class="text-right" style="">
                                                            <div class="fixed-btn">
                                                                <button type="button" class="btn btn-danger" id="btn-delete-address">Remover
                                                                </button>
                                                                <button class="btn btn-success" id="btn-add-address">
                                                                    Adicionar</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>                                        
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div role="tabpanel" class="tab-pane fade" id="tab-mechanism-contact">
                            <div class="col-md-12">
								<div class="p-20 row">
	                                <div class="col-sm-6">
	                                    <h3 class="m-t-0">Formas de contato do escritorio</h3>
	                                </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="contact-mechanism">
						                    <div class="table-responsive">
						                        <table class="table table-striped table-hover" paginate-fixed id="contact-mechanism-table">
						                            {% block table_contact_mechanism.thead %}
						                                <thead>
						                                <tr>
						                                    {% for column in table_contact_mechanism.columns %}
						                                        {% if column.orderable %}
						                                            <th {{ column.attrs.th.as_html }}><a
						                                                    href="{% querystring table_contact_mechanism.prefixed_order_by_field=column.order_by_alias.next %}">
						                                                    {{ column.header|lower|capfirst }}</a>
						                                            </th>
						                                        {% else %}
						                                            {% if not column.attrs.selectable == True %}
						                                                <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
						                                            {% else %}
						                                                <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
						                                            {% endif %}
						                                        {% endif %}
						                                    {% endfor %}
						                                </tr>
						                                </thead>
						                            {% endblock table_contact_mechanism.thead %}
						                            {% block table_contact_mechanism.tbody %}
						                                <tbody>
						                                {% for row in table_contact_mechanism.page.object_list|default:table_contact_mechanism.rows %} {# support pagination #}
						                                    {% block table_contact_mechanism.tbody.row %}
						                                        <tr class="{% cycle "odd" "even" %}" pk="{{ row.attrs.pk }}" id="{{ row.attrs.pk }}">
						                                            {% for column, cell in row.items %}
						                                                <td {{ column.attrs.td.as_html }}>{{ cell }}</td>
						                                            {% endfor %}
						                                        </tr>
						                                    {% endblock table_contact_mechanism.tbody.row %}
						                                {% empty %}
						                                    {% if table_contact_mechanism.empty_text %}
						                                        {% block table_contact_mechanism.tbody.empty_text %}
						                                            <tr>
						                                                <td colspan="{{ table_contact_mechanism.columns|length }}">{{ table_contact_mechanism.empty_text }}</td>
						                                            </tr>
						                                        {% endblock table_contact_mechanism.tbody.empty_text %}
						                                    {% endif %}
						                                {% endfor %}
						                                </tbody>
						                            {% endblock table_contact_mechanism.tbody %}
						                            {% block table_contact_mechanism.tfoot %}
						                                <tfoot></tfoot>
						                            {% endblock table_contact_mechanism.tfoot %}
						                        </table>
						                    </div>
                                            {% if 'group_admin' in office_session_perms and is_session_office %}
                                                <div class="text-right btn-table-actions">
                                                    <div class="text-right" style="">
                                                        <div class="fixed-btn">
                                                            <button type="button" class="btn btn-danger" id="btn-delete-contact-mechanism">Remover
                                                            </button>
                                                            <button class="btn btn-success" id="btn-add-contact-mechanism">
                                                                Adicionar</button>
                                                        </div>
                                                    </div>
                                                </div>							                    
                                            {% endif %}
                                        </div>                                        
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        {% if 'group_admin' in office_session_perms and is_session_office %}
                            <div role="tabpanel" class="tab-pane fade" id="tab-invite-users">
                                <div class="col-md-12">
                                    <div class="invite-user">
                                        <div class="white-box">
                                            <ul class="nav nav-tabs">
                                                <li id="li-invite-users"><a data-toggle="tab" href="#invite-users">Convidar Usuários</a></li>
                                                <li id="li-invite-my-persons"><a data-toggle="tab" href="#my-invite-persons">Solicitações de Usuários</a></li>
                                                <li id="li-office-users"><a data-toggle="tab" href="#office-users">Usuários Vinculados</a></li>
                                            </ul>
                                            <div class="tab-content">
                                                <div id="invite-users" class="tab-pane fade active in">
                                                    <form class="form-inline editable-form" id="form-invite-user" action="#">
                                                        {% csrf_token %}
                                                        <input type="text" value="{{ office.pk }}" name="office" hidden>
                                                        {% if 'group_admin' in office_session_perms or request.user.is_superuser %}
                                                            <div class="control-group">
                                                                <div class="editable-input" style="width: 85%">                                                            
                                                                    <input class="form-control input-sm twitter-typeahead" type="text" placeholder="Usuário a convidar..." style="padding-right: 24px; width: 100%" id="person" data-url="/typeahead/search/inviteuser" name="person" value="" data-module="core.models" data-model="Person" search-field="legal_name">
                                                                    <span class="editable-clear-x" style="display: none;"></span>
                                                                </div>
                                                                <div class="editable-buttons">
                                                                    <button type="button" class="btn btn-success btn-sm editable-submit" id="btn-invite-user"><i class="glyphicon glyphicon-ok"> Convidar</i></button>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    </form>
                                                    <div id="invite-table">

                                                    </div>
                                                </div>
                                                <div id="my-invite-persons" class="tab-pane fade">
                                                    <div class="table-responsive">
                                                        {% get_opened_person_invites office as oppened_invites %} {% if not oppened_invites %}
                                                        <div class="alert alert-info alert-dismissable">
                                                            <p>
                                                                <i class="fa fa-1x fa-info-circle" aria-hidden="true"> </i>
                                                                <strong>Este escritório não possui nenhum convite pendente!</strong>
                                                            </p>
                                                        </div>
                                                        {% else %}
                                                        <table class="table table-striped table-hover" paginate-fixed>
                                                            <thead>
                                                                <tr>
                                                                    <th>Pessoa</th>
                                                                    <th>CPF/CNPJ</th>
                                                                    <th>Aceitar</th>
                                                                    <th>Recusar</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {% for invite in oppened_invites %}
                                                                <tr class="{% cycle 'odd' 'even' %}">
                                                                    <td>{{ invite.person.legal_name }}</td>
                                                                    <td>{{ invite.person.cpf_cnpj|default_if_none:'' }}</td>
                                                                    <td>
                                                                        <button type="button" class="btn btn-outline btn-success btn-rounded" onclick="updateInvite('{{ invite.pk }}', 'A', '{{ csrf_token }}', '/convites/invite_update/')">
                                                                            <i class="fa fa-thumbs-o-up"></i>
                                                                        </button>
                                                                    </td>
                                                                    <td>
                                                                        <button type="button" class="btn btn-outline btn-danger btn-rounded" onclick="updateInvite('{{ invite.pk }}', 'R', '{{ csrf_token }}', '/convites/invite_update/')">
                                                                            <i class="fa fa-thumbs-o-down"></i>
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                                {% endfor %}
                                                            </tbody>
                                                        </table>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div id="office-users" class="tab-pane fade">
                                                    <form action="{% url 'office_membership_inactive' office_pk=office.pk %}" method="post" id="membersForm">{% csrf_token %}
                                                        <div class="table-responsive">
                                                            <table class="table table-striped table-hover">
                                                                {% block table_members.thead %}
                                                                <thead>
                                                                    <tr>
                                                                        {% for column in table_members.columns %} {% if column.orderable %}
                                                                        <th {{ column.attrs.th.as_html }}><a href="{% querystring table_members.prefixed_order_by_field=column.order_by_alias.next %}">{{ column.header|lower|capfirst }}</a>
                                                                        </th>
                                                                        {% else %} {% if not column.attrs.selectable == True %}
                                                                        <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                                                        {% else %}
                                                                        <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                                                        {% endif %} {% endif %} {% endfor %}
                                                                    </tr>
                                                                </thead>
                                                                {% endblock table_members.thead %} {% block table_members.tbody %}
                                                                <tbody>
                                                                    {% for row in table_members.page.object_list|default:table_members.rows %} {% block table_members.tbody.row %}
                                                                    <tr class="{% cycle " odd " "even " %}" data-href="{{ row.attrs.data_href }}">
                                                                        {% for column, cell in row.items %}
                                                                        <td {{ column.attrs.td.as_html }}>{{ cell }}</td>
                                                                        {% endfor %}
                                                                    </tr>
                                                                    {% endblock table_members.tbody.row %} {% empty %} {% if table.empty_text %} {% block table_members.tbody.empty_text %}
                                                                    <tr>
                                                                        <td colspan="{{ table_members.columns|length }}">{{ table_members.empty_text }}</td>
                                                                    </tr>
                                                                    {% endblock table_members.tbody.empty_text %} {% endif %} {% endfor %}
                                                                </tbody>
                                                                {% endblock table_members.tbody %} {% block table_members.tfoot %}
                                                                <tfoot></tfoot>
                                                                {% endblock table_members.tfoot %}
                                                            </table>
                                                        </div>
                                                        <div class="text-right" style="">
                                                            <div class="text-right" style="">
                                                                <div class="fixed-btn">
                                                                    <button type="button" id="delete_button" class="btn btn-danger" onclick="warningDelete(this)" disabled>Desvincular
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                            <div role="tabpanel" class="tab-pane fade" id="tab-invite-office">
                                <div class="invite-office">
                                    <div class="white-box">
                                        <ul class="nav nav-tabs">
                                            <li id="li-invite-offices"><a data-toggle="tab" href="#invite-offices">Convidar Escritórios</a></li>
                                            <li id="li-invite-my-offices"><a data-toggle="tab" href="#my-invite-offices">Solicitações de Escritórios</a></li>
                                            <li id="li-office-offices"><a data-toggle="tab" href="#office-offices">Escritórios Vinculados</a></li>
                                        </ul>

                                        <div class="tab-content">
                                            <div id="invite-offices" class="tab-pane fade active in">
                                                <form class="form-inline editable-form" id="form-invite-office" action="#">
                                                    {% csrf_token %}
                                                    <input type="text" value="{{ office.pk }}" name="office" hidden>
                                                    <div class="control-group">
                                                        <div class="editable-input" style="width: 85%">
                                                            <input class="form-control input-sm twitter-typeahead" type="text" placeholder="Escritório a convidar..." style="padding-right: 24px; width: 100%" id="office_invite" data-url="/typeahead/search/inviteoffice" name="office_invite" value="" data-module="core.models" data-model="Office" search-field="legal_name">
                                                            <span class="editable-clear-x" style="display: none;"></span>
                                                        </div>
                                                        <div class="editable-buttons">
                                                            <button type="button" class="btn btn-success btn-sm editable-submit" id="btn-invite-office"><i class="glyphicon glyphicon-ok"> Convidar</i></button>
                                                        </div>
                                                    </div>
                                                </form>
                                                <div id="invite-table-office">

                                                </div>
                                            </div>
                                            <div id="my-invite-offices" class="tab-pane fade">
                                                <div class="table-responsive">
                                                    {% get_opened_office_invites office as oppened_invites %} {% if not oppened_invites %}
                                                    <div class="alert alert-info alert-dismissable">
                                                        <p>
                                                            <i class="fa fa-1x fa-info-circle" aria-hidden="true"> </i>
                                                            <strong>Este escritório não possui nenhum convite pendente!</strong>
                                                        </p>
                                                    </div>
                                                    {% else %}
                                                    <table class="table table-striped table-hover" paginate-fixed>
                                                        <thead>
                                                            <tr>
                                                                <th>Escritório</th>
                                                                <th>CPF/CNPJ</th>
                                                                <th>Aceitar</th>
                                                                <th>Recusar</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for invite in oppened_invites %}
                                                            <tr class="{% cycle 'odd' 'even' %}">
                                                                <td>{{ invite.office.legal_name }}</td>
                                                                <td>{{ invite.office.cpf_cnpj|default_if_none:'' }}</td>
                                                                <td>
                                                                    <button type="button" class="btn btn-outline btn-success btn-rounded" onclick="updateInvite('{{ invite.pk }}', 'A', '{{ csrf_token }}', '/convites/invite_office_update/')">
                                                                        <i class="fa fa-thumbs-o-up"></i>
                                                                    </button>
                                                                </td>
                                                                <td>
                                                                    <button type="button" class="btn btn-outline btn-danger btn-rounded" onclick="updateInvite('{{ invite.pk }}', 'R', '{{ csrf_token }}', '/convites/invite_office_update/')">
                                                                        <i class="fa fa-thumbs-o-down"></i>
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div id="office-offices" class="tab-pane fade">
                                                <form action="{% url 'office_offices_inactive' office_pk=office.pk %}" method="post" id="officesForm">{% csrf_token %}
                                                    <div class="table-responsive">
                                                        <table class="table table-striped table-hover" paginate-fixed>
                                                            {% block table_offices.thead %}
                                                            <thead>
                                                                <tr>
                                                                    {% for column in table_offices.columns %} {% if column.orderable %}
                                                                    <th {{ column.attrs.th.as_html }}><a href="{% querystring table_offices.prefixed_order_by_field=column.order_by_alias.next %}">{{ column.header|lower|capfirst }}</a>
                                                                    </th>
                                                                    {% else %} {% if not column.attrs.selectable == True %}
                                                                    <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                                                    {% else %}
                                                                    <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                                                    {% endif %} {% endif %} {% endfor %}
                                                                </tr>
                                                            </thead>
                                                            {% endblock table_offices.thead %} {% block table_offices.tbody %}
                                                            <tbody>
                                                                {% for row in table_offices.page.object_list|default:table_offices.rows %} {% block table_offices.tbody.row %}
                                                                <tr class="{% cycle " odd " "even " %}" data-href="{{ row.attrs.data_href }}">
                                                                    {% for column, cell in row.items %}
                                                                    <td {{ column.attrs.td.as_html }}>{{ cell }}</td>
                                                                    {% endfor %}
                                                                </tr>
                                                                {% endblock table_offices.tbody.row %} {% empty %} {% if table.empty_text %} {% block table_offices.tbody.empty_text %}
                                                                <tr>
                                                                    <td colspan="{{ table_offices.columns|length }}">{{ table_offices.empty_text }}</td>
                                                                </tr>
                                                                {% endblock table_offices.tbody.empty_text %} {% endif %} {% endfor %}
                                                            </tbody>
                                                            {% endblock table_offices.tbody %} {% block table_offices.tfoot %}
                                                            <tfoot></tfoot>
                                                            {% endblock table_offices.tfoot %}
                                                        </table>
                                                    </div>
                                                    <div class="text-right" style="">
                                                        <div class="text-right" style="">
                                                            <div class="fixed-btn">
                                                                <button type="button" id="delete_button" class="btn btn-danger" onclick="warningDelete(this)" disabled>Desvincular
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div role="tabpanel" class="tab-pane fade" id="tab-billign-details">
                                <div class="col-md-12">
                                    <div class="p-20 row">
                                        <div class="col-sm-6">
                                            <h3 class="m-t-0">Detalhes de cobrança cadastrados</h3>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="address">
                                                <div id="endereco">
                                                    <div class="modal-content">
                                                      <form enctype="multipart/form-data"  method="POST" action="{% url 'create_billing_detail' %}" autocomplete="off" id="form-billing-detail">{% csrf_token %}
                                                        <div class="modal-body">
                                                          <fieldset>
                                                              <div class="row">
                                                                 <div class="col-xs-6">
                                                                    {% bootstrap_field form_billing_details.full_name label_class='ezl-required' %}
                                                                 </div>
                                                                 <div class="col-xs-6">
                                                                    {% bootstrap_field form_billing_details.cpf label_class='ezl-required' %}
                                                                 </div>
                                                              </div>
                                                              <div class="row">
                                                                 <div class="col-xs-6">
                                                                     {% bootstrap_field form_billing_details.birth_date label_class='ezl-required' %}
                                                                 </div>
                                                                  <div class="col-xs-6">
                                                                      {% bootstrap_field form_billing_details.email label_class='ezl-required' %}
                                                                  </div>
                                                              </div>
                                                              <div class="row">
                                                                 <div class="col-xs-6">
                                                                     {% bootstrap_field form_billing_details.phone_number label_class='ezl-required' %}
                                                                 </div>
                                                                  <div class="col-xs-6">
                                                                     {% bootstrap_field form_billing_details.phone_type %}
                                                                 </div>
                                                              </div>
                                                              <div class="row">
                                                                <div class="col col-xs-3">
                                                                    {% bootstrap_field form_billing_details.zip_code label_class='ezl-required' %}
                                                                </div>
                                                                <div class="col col-xs-6">
                                                                  {% bootstrap_field form_billing_details.street label_class='ezl-required' %}
                                                                </div>
                                                                <div class="col col-xs-3">
                                                                  {% bootstrap_field form_billing_details.number label_class='ezl-required' %}
                                                                </div>
                                                              </div>
                                                              <div class="row">
                                                                <div class="col col-xs-3">
                                                                  {% bootstrap_field form_billing_details.complement %}
                                                                </div>
                                                                <div class="col col-xs-3">
                                                                  {% bootstrap_field form_billing_details.city_region label_class='ezl-required' %}
                                                                </div>
                                                                <div class="col col-xs-6">
                                                                  {% bootstrap_field form_billing_details.city label_class='ezl-required' %}
                                                                </div>
                                                              </div>
                                                              <div class="p-20 row">
                                                                  <div class="col-sm-6">
                                                                      <h3 class="m-t-0">Dados do cartão</h3>
                                                                  </div>
                                                              </div>
                                                              <div class="row">
                                                                 <div class="col-xs-6">
                                                                    {% bootstrap_field form_billing_details.card_name label_class='ezl-required' %}
                                                                 </div>
                                                                 <div class="col-xs-6">
                                                                    {% bootstrap_field form_billing_details.cpf_cnpj label_class='ezl-required' %}
                                                                 </div>
                                                              </div>
                                                              <div class="p-20 row">
                                                                  <div class="col-sm-6">
                                                                       <h3 class="m-t-0">Conta Yapay</h3>
                                                                  </div>
                                                              </div>
                                                              <div class="row">
                                                                <div class="col col-xs-6">
                                                                  {% bootstrap_field form_billing_details.person_type %}
                                                                </div>
                                                                <div class="col col-xs-6">
                                                                  {% bootstrap_field form_billing_details.password %}
                                                                </div>
                                                              </div>
                                                              <button type="button" class="btn btn-danger" id="btn-yapay-billing-detail">Cadastrar Yapay</button>
                                                              {% for row in table_billing_details.page.object_list|default:table_billing_details.rows %}
                                                                    <input type="hidden" id="billing_detail_id" name="billing_detail_id" value="{{ row.attrs.pk }}">
                                                              {% endfor %}
                                                          </fieldset>
                                                        </div>
                                                        <div class="modal-footer">
                                                          <button type="submit" class="btn btn-success" id="btn-save-billing-detail">Salvar</button>
                                                        </div>
                                                      </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% if is_session_office %}
{% include 'core/modal/office_profile_basic.html' %}
{% include 'core/modal/office_profile_address.html' %}
{% include 'core/modal/office_profile_contact_mechanism.html' with form=form_contact_mechanism %}
{% include 'core/modal/office_profile_billing_details.html' with form=form_billing_details %}
{% endif %}
{%endblock%}

{% block extra_scripts %}
    <!-- Custom Theme JavaScript -->
    <script src="{% static 'skeleton/js/jquery.mask.min.js' %}?rev={{request.REVIEW}}"></script>
    <script src="{% static 'skeleton/plugins/bower_components/datatables/jquery.dataTables.min.js' %}?rev={{request.REVIEW}}"></script>
    <script src="{% static 'core/js/controller/office.js' %}?rev={{request.REVIEW}}"></script>
    <script src="{% static 'core/js/controller/address.js' %}?rev={{request.REVIEW}}"></script>
    <script src="{% static 'core/js/controller/contact_mechanism.js' %}?rev={{request.REVIEW}}"></script>
    <script src="{% static 'core/js/controller/billing-details.js' %}?rev={{request.REVIEW}}"></script>
    <script src="{% static 'core/js/controller/areas-expertise.js' %}?rev={{request.REVIEW}}"></script>
    {% if view.model.use_upload %}
        <!-- UPLOADS SCRIPTS  -->
        {% include 'ecm/javascripts.html' %}
        <script src="{% static 'libs/jQuery-File-Upload/js/vendor/jquery.ui.widget.js' %}?rev={{request.REVIEW}}"></script>
        <script src="{% static 'libs/jQuery-File-Upload/js/jquery.iframe-transport.js' %}?rev={{request.REVIEW}}"></script>
        <script src="{% static 'libs/jQuery-File-Upload/js/jquery.fileupload.js' %}?rev={{request.REVIEW}}"></script>
        <script src="{% static 'skeleton/plugins/bower_components/jquery.tmpl/jquery.tmpl.js' %}?rev={{request.REVIEW}}"></script>
        <!-- DIV para o Ajax localizar o local (pelo ID) onde será incluído os novos scripts de deleção
             a medida que for adicionando novos arquivos -->
        <div id="scripts">
        </div>
    {% endif %}
    {{ inviteofficeform.media }}
    {#    Convite de usuario #}
    <script> 
        $.fn.modal.Constructor.prototype.enforceFocus = function() {};
        var office = new Office('{{office.pk}}');
        var address = new Address("{{office.pk}}");
        var contactMechanism = new ContactMechanism();
        var billingDetail = new BillingDetail("{{office.pk}}");
        var areasExpertise = new AreasOfExpertise('{{ csrf_token }}');
        var menuOpen = true;
        $(document).ready(function () {
		    $(".open-close").on("click", function () {
		    	if (menuOpen) {
		    		$('.profile-data').css('width', '100%');
		    		menuOpen = false;			    		
		    	} else {
		    		$('.profile-data').css('width', '83.33%');
		    		menuOpen = true;	    		
		    	}
		    });
            var invites = [
                {
                    btn: '#btn-invite-user',
                    url: '/convites/criar',
                    table_id: '#invite-table',
                    table_url: '/convites/table/',
                    el: '#invite-users'
                },
                {
                    btn: '#btn-invite-office',
                    url: '/convites/office/criar',
                    table_id: '#invite-table-office',
                    table_url: '/convites/office/table/',
                    el: '#invite-offices'
                }
            ];

            function isEmail(email) {
              var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
              return regex.test(email);
            }

            invites.forEach(function (invite) {
                var inviteTable = $(invite.table_id);
                inviteTable.load(invite.table_url + '{{ office.pk }}' + '/', invite.table_id);
                $(invite.btn).on('click', function (event) {
                    $('#inviting').modal('show');
                    var data = {};
                    $(invite.el).find('input').each(function () {
                        var person = $('#person');
                        if (person.attr('value') === "" && isEmail(person.val())){
                            person.attr('value', person.val())
                        }
                        if ($(this).attr('name')) {
                            data[$(this).attr('name')] = $(this).attr('value')
                        }
                    });
                    $.ajax({
                        type: 'POST',
                        url: invite.url,
                        data: data,
                        success: function (result, status, xhr) {
                            if (result.error) {
                                showToast('error', 'Atenção', result.error, 0, false);
                            }
                            inviteTable.load(invite.table_url + '{{ office.pk }}' + '/', invite.table_id);
                            $(invite.el + ' .twitter-typeahead').typeahead('val', '');
                            $('#inviting').modal('hide');
                        },
                        error: function (request, status, error) {

                        },
                        beforeSend: function (xhr, settings) {
                            xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
                        },
                        dataType: 'json'
                    })
                });
            });
        });
    </script>

    <script language="JavaScript">
        // Warning Delete Message
        function warningDelete(source) {
            {% if on_delete == 'CASCADE' %}
                var text = "Ao excluir excluir o(s) registro(s) selecionado(s), todos os seus " +
                    "vínculos também serão excluídos! Essa ação é irreversível";
            {% else %}
                var text = "Tem certeza que deseja excluir o(s) registro(s) selecionado(s)? " +
                    "Essa ação é irreversível.";
            {% endif %}
            var action = "Excluir";
            if ((source.form.id == 'membersForm') || (source.form.id == 'officesForm')) {                
                if (source.form.id == 'membersForm')
                    text = "Tem certeza que deseja desvincular a(s) pessoa(s) selecionada(s) deste escritório? ";
                else
                if (source.form.id == 'officesForm')
                    text = "Tem certeza que deseja desvincular o(s) escritório(s) selecionado(s) deste escritório? ";
                action = "Desvincular"
            }

            swal({
                title: action + "?",
                text: text,
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Sim, desejo " + action.toLowerCase(),
                cancelButtonText: "Cancelar"
            }).then(function (result) {
                if (result.value){
                    $('#' + source.form.id).submit()                    
                }
            });
        }

        var pk_list = [];

        function toggle(source) {                        
            checkboxes = source.form.elements.selection;
            for (var i in checkboxes) {

                if (checkboxes.hasOwnProperty(i)) {
                    checkboxes[i].checked = source.checked;
                    if (source.checked)
                        pk_list.push(checkboxes[i].id);
                    else
                        pk_list = []
                }
            }
            if (pk_list.length > 0) {
                $("#" + source.form.id + " #delete_button").attr('disabled', false);
            } else {
                $("#" + source.form.id + " #delete_button").attr('disabled', true);
            }
        }
        function showDeleteButton(source) {
            if (source.checked) {
                pk_list.push(source.id);
            } else {
                pk_list.pop();
                $("#" + source.form.id + " #selection_header").attr('checked', false);
            }

            if (pk_list.length > 0)
                $("#" + source.form.id + " #delete_button").attr('disabled', false);
            else
                $("#" + source.form.id + " #delete_button").attr('disabled', true);
        }
    </script>
    <!-- DataTables -->    
    
{% endblock %}
{% block extra_modal %}
    <!-- Janela modal para mostrar progresso de deleção do arquivo -->
    <div id="inviting" class="modal">
        <div class="modal-dialog modal-sm">
            <div class="modal-content ">
                <div class="modal-body" style="text-align: center;">
                    <h1>Aguarde...</h1>
                    <p class="h1"><i class="fa fa-spin fa-circle-o-notch"></i></p>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
{% endblock extra_modal %}


{% block extra_stylesheets %}
    <link href="/static/autocomplete_light/vendor/select2/dist/css/select2.css" type="text/css" media="all" rel="stylesheet" />
    <link href="/static/autocomplete_light/select2.css" type="text/css" media="all" rel="stylesheet" />
	<style type="text/css">
		.container-fluid {
			padding: 0 !important;
		}
		.profile {
			height: 100%;            
		}
		.profile-heading {			
			background-image: url("{% static 'skeleton/images/banner-profile-810x520.jpg'%}");
			color: #fff;
			height: 180px;			
		}
		.profile-logo img {
			height: 160px;
			width: 160px;
		}
		.profile-title {
			height: 100px;
			position: relative;
			line-height: 100px;
		}
		.profile-title h1 {
			color: #fff;
			text-align: center;
			line-height: 150px;
			vertical-align: middle;
			margin-top: 0;
		}
		.profile-body {						
			margin-top: 40px;			
		}
		.profile-panel {
			background-color: #0d3c55 !important;
			color: #fff !important;
		}
		.profile-panel .pull-right a{
			color: #fff !important;
		}

		.profile .panel .panel-heading {
			padding: 10px;
		}	

        .profile-data {
            position: absolute !important;
            width: 83.33%;
            float: right;
            top: 110px;            
        }
        .custom-white-box {
            margin-left: 25px !important;
            margin-right: 25px !important;
            box-shadow: 2px 2px 2px 2px #d9d9d9;
        }
        #more-info {
            padding-top: 5px !important;
        }
        #contact-mechanism{
        	background-color: #fff
        }

        .btn-table-actions {
        	padding-bottom: 10px !important;
        }
	</style>

{% endblock %}