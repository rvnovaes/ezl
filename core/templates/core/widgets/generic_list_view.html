
{% extends 'skeleton/base.html' %}
{% load static core_match %}

{% block extra_stylesheets %}
    <link href="{% static 'skeleton/plugins/bower_components/datatables/jquery.dataTables.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="//cdn.datatables.net/buttons/1.2.2/css/buttons.dataTables.min.css" rel="stylesheet" type="text/css" />
    <style>
        table.dataTable.row-border tbody tr:first-child th, table.dataTable.row-border tbody tr:first-child td, table.dataTable.display tbody tr:first-child th, table.dataTable.display tbody tr:first-child td {
            font-size: small !important;
            cursor: pointer;
        }
        tr {
            cursor: pointer;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-12">
            {% include 'core/widgets/generic_search_view.html' %}
            <div class="panel panel-default">
                <div class="panel-heading">{{ form_name_plural|capfirst }}
                    <div class="panel-action">
                        <button class="btn btn-sm btn-danger" data-toggle="modal" data-target="#confirmDelete"
                                disabled id="delete_button">
                            <i class="fa fa-trash"></i> Apagar
                        </button>
                        <button  class="btn btn-sm btn-success"
                            onclick="window.open('{% if link_add_url %}{{ link_add_url }}{% elif link_add %}{% url link_add %}{% endif %}', '_self')">
                            <i class="fa fa-plus"></i> Novo
                        </button>
                    </div>
                </div>
                <div class="panel-wrapper collapse in">
                    <div class="panel-body">
                        <table id="tableList" class="display" cellspacing="0">
                            <thead>
                                <tr>
                                    {% for column in table.columns %}
                                    <th>{{ column.header }}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                        <tbody>
                        {% for row in table.page.object_list|default:table.rows %} {# support pagination #}
                            <a href="{{ row.attrs.data_href }}">
                            <tr>
                                {% for column, cell in row.items %}
                                    <td {{ column.attrs.td.as_html }}>{{ cell }}</td>
                                {% endfor %}
                            </tr>
                            </a>
                        {% endfor %}
                        </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock content %}
{% block modal %}
    <!-- Modal -->
    <div id="confirmDelete" class="modal">
        <div class="modal-dialog">
            <div class="modal-content ">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title"><i class="fa fa-trash">warning</i></h4>
                    <h4 class="modal-title">Atenção!</h4>
                </div>
                <div class="modal-body">
                    {% if on_delete == 'CASCADE' %}
                        <p>Ao excluir o(s) registro(s) de {{ form_name.title }} todos os seus vínculos também
                            serão excluídos! Essa ação é irreversível. Deseja continuar?</p>
                    {% else %}
                        <p>Tem certeza que deseja excluir o(s) registro(s)
                            de {{ form_name.title }} selecionado(s)? Essa ação é irreversível. Deseja continuar?</p>
                    {% endif %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Sim</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block extra_scripts %}
    <script src="{% static 'skeleton/plugins/bower_components/datatables/jquery.dataTables.min.js' %}"></script>
    <!-- start - This is for export functionality only -->
    <script src="//cdn.datatables.net/buttons/1.2.2/js/dataTables.buttons.min.js"></script>
    <script src="//cdn.datatables.net/buttons/1.2.2/js/buttons.flash.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
    <script src="//cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/pdfmake.min.js"></script>
    <script src="//cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js"></script>
    <script src="//cdn.datatables.net/buttons/1.2.2/js/buttons.html5.min.js"></script>
    <script src="//cdn.datatables.net/buttons/1.2.2/js/buttons.print.min.js"></script>
    <script src="{% static "libs/bootstrap-ajax-typeahead/js/bootstrap-typeahead.min.js" %}"></script>
    <script src="{% static "js/autocomplete.js" %}"></script>
    <script>
        var pk_list = [];

        function toggle(source) {


            checkboxes = document.getElementsByName('selection');
            for (var i in checkboxes) {

                if (checkboxes.hasOwnProperty(i)) {
                    checkboxes[i].checked = source.checked;
                    if (source.checked)
                        pk_list.push(checkboxes[i].id);
                    else
                        pk_list = []
                }
            }
            if (pk_list.length > 0) {
                document.getElementById('delete_button').disabled = false;
            } else {
                document.getElementById('delete_button').disabled = true;
            }
        }
        function showDeleteButton(source) {
            if (source.checked) {
                pk_list.push(source.id);
            } else {
                pk_list.pop();
                document.getElementById("selection_header").checked = false;
            }

            if (pk_list.length > 0)
                document.getElementById('delete_button').disabled = false;
            else
                document.getElementById('delete_button').disabled = true;

        }
    </script>
{% endblock %}

{% block script_document_ready %}
        var table = $('#tableList').DataTable({
                pageLength: 5,
                dom: 'Bfrtip',
                //ajax: '{% url 'ajax_get_task_data_table' %}?status=' + status,
                buttons: [
                    'copy', 'csv', 'excel', 'pdf', 'print'
                ],
                language: {
                    "url": "//cdn.datatables.net/plug-ins/1.10.16/i18n/Portuguese-Brasil.json"
                },
                columnDefs: [ {
                    orderable: false,
                    searchable: false,
                    targets:   0
                } ],
        })
        $('#tableList tbody').on( 'click', 'tr', function () {
            var pk = table.row( this ).data();
            console.log('>>>', pk)
        });
{% endblock %}

{% block extra_modal %}
    {% include 'task/modal/view-task-table.html' %}
{% endblock %}

{% comment %}
{% extends 'inicial.html' %}
{% load render_table from django_tables2 %}
{% load static %}
{% load querystring from django_tables2 %}
{% load bootstrap3 %}
{% load core_filters %}
{% block content %}
    {% if table.page %}
        <div class="table-container">
    {% endif %}
<script language="JavaScript">
    $('#myModal').modal('show')
    var pk_list = [];

    function toggle(source) {


        checkboxes = document.getElementsByName('selection');
        for (var i in checkboxes) {

            if (checkboxes.hasOwnProperty(i)) {
                checkboxes[i].checked = source.checked;
                if (source.checked)
                    pk_list.push(checkboxes[i].id);
                else
                    pk_list = []
            }
        }
        if (pk_list.length > 0) {
            document.getElementById('delete_button').disabled = false;
        } else {
            document.getElementById('delete_button').disabled = true;
        }
    }
    function showDeleteButton(source) {
        if (source.checked) {
            pk_list.push(source.id);
        } else {
            pk_list.pop();
            document.getElementById("selection_header").checked = false;
        }

        if (pk_list.length > 0)
            document.getElementById('delete_button').disabled = false;
        else
            document.getElementById('delete_button').disabled = true;

    }
</script>
{% include 'core/widgets/messages.html' %}
{% include 'core/widgets/generic_search_view.html' %}
<form action="{% url link_ex %}" method="post">
    {% csrf_token %}
    {% block table %}
        <div class="panel panel-primary">
        <div class="panel-heading">
            <div class="panel-title form-row">{{ form_name_plural.capitalize }}</div>
        </div>
        <div class="panel-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover" paginate-fixed>
                    {% block table.thead %}
                        <thead>
                        <tr>
                            {% for column in table.columns %}
                                {% if column.orderable %}
                                    <th {{ column.attrs.th.as_html }}><a
                                            href="{% querystring table.prefixed_order_by_field=column.order_by_alias.next %}">{{ column.header|lower|capfirst }}</a>
                                    </th>
                                {% else %}
                                    {% if not column.attrs.selectable == True %}
                                        <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                    {% else %}
                                        <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </tr>
                        </thead>
                    {% endblock table.thead %}
                    {% block table.tbody %}
                        <tbody>
                        {% for row in table.page.object_list|default:table.rows %} {# support pagination #}
                            {% block table.tbody.row %}
                                <tr class="{% cycle "odd" "even" %}" data-href="{{ row.attrs.data_href }}">
                                    {% for column, cell in row.items %}
                                        <td {{ column.attrs.td.as_html }}>{{ cell }}</td>
                                    {% endfor %}
                                </tr>
                            {% endblock table.tbody.row %}
                        {% empty %}
                            {% if table.empty_text %}
                                {% block table.tbody.empty_text %}
                                    <tr>
                                        <td colspan="{{ table.columns|length }}">{{ table.empty_text }}</td>
                                    </tr>
                                {% endblock table.tbody.empty_text %}
                            {% endif %}
                        {% endfor %}
                        </tbody>
                    {% endblock table.tbody %}
                    {% block table.tfoot %}
                        <tfoot></tfoot>
                    {% endblock table.tfoot %}
                </table>
            </div>
            <div class="pagination-fixed">
                {% if table.page %}
                    {% block pagination %}
                        {% bootstrap_pagination table.page url=request.get_full_path %}
                    {% endblock pagination %}
                {% endif %}
            </div>
            <div class="text-right" style="margin: auto">
                <div class="fixed-btn">
                    <input type="button" data-toggle="modal" data-target="#confirmDelete" disabled id="delete_button"
                           class="btn btn-fab btn-warning material-icons"
                           value="remove">
                    <a class="btn btn-fab btn-primary" href="{% if link_add_url %}{{ link_add_url }}{% elif link_add %}{% url link_add %}{% endif %}">
                        <i class="material-icons">add</i></a>
                </div>
            </div>
        </div>
    {% endblock table %}
    <!-- Modal -->
    <div id="confirmDelete" class="modal">
        <div class="modal-dialog">
            <div class="modal-content ">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title"><i class="material-icons">warning</i></h4>
                    <h4 class="modal-title">Atenção!</h4>
                </div>
                <div class="modal-body">
                    {% if on_delete == 'CASCADE' %}
                        <p>Ao excluir o(s) registro(s) de {{ form_name.title }} todos os seus vínculos também
                            serão excluídos! Essa ação é irreversível. Deseja continuar?</p>
                    {% else %}
                        <p>Tem certeza que deseja excluir o(s) registro(s)
                            de {{ form_name.title }} selecionado(s)? Essa ação é irreversível. Deseja continuar?</p>
                    {% endif %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Sim</button>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock content %}
{% endcomment %}