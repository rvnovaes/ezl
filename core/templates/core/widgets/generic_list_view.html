{% extends 'inicial.html' %}
{% load render_table from django_tables2 %}
{% load static %}
{% load querystring from django_tables2 %}
{% load bootstrap3 %}
{% load core_filters %}

{% block extrajs %}
    {{ block.super }}
    <script src="{% static "js/editable-list.js" %}"></script>
{% endblock %}

{% block content %}
    {% if table.page %}
        <div class="table-container">
    {% endif %}
<script language="JavaScript">
    $('#myModal').modal('show')
    var pk_list = [];

    function toggle(source) {


        checkboxes = document.getElementsByName('selection');
        for (var i in checkboxes) {

            if (checkboxes.hasOwnProperty(i)) {
                checkboxes[i].checked = source.checked;
                if (source.checked)
                    pk_list.push(checkboxes[i].id);
                else
                    pk_list = []
            }
        }
        if (pk_list.length > 0) {
            document.getElementById('delete_button').disabled = false;
        } else {
            document.getElementById('delete_button').disabled = true;
        }
    }

    function showDeleteButton(source) {
        if (source.checked) {
            pk_list.push(source.id);
        } else {
            pk_list.pop();
            document.getElementById("selection_header").checked = false;
        }

        if (pk_list.length > 0)
            document.getElementById('delete_button').disabled = false;
        else
            document.getElementById('delete_button').disabled = true;

    }
</script>
{% include 'core/widgets/messages.html' %}
{% include 'core/widgets/generic_search_view.html' %}
<form action="{% url link_ex %}" method="post">
    {% csrf_token %}
    {% block table %}
        <div class="panel panel-primary">
        <div class="panel-heading">
            <div class="panel-title form-row">{{ form_name_plural.capitalize }}</div>
        </div>
        <div class="panel-body">
            <div class="table-responsive" {% if editable_list %}editable-list{% endif %}>
                <table class="table table-striped table-hover" paginate-fixed>
                    {% block table.thead %}
                        <thead>
                        <tr>
                            {% for column in table.columns %}
                                {% if column.orderable %}
                                    <th {{ column.attrs.th.as_html }}><a
                                            href="{% querystring table.prefixed_order_by_field=column.order_by_alias.next %}">{{ column.header|lower|capfirst }}</a>
                                    </th>
                                {% else %}
                                    {% if not column.attrs.selectable == True %}
                                        <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                    {% else %}
                                        <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </tr>
                        </thead>
                    {% endblock table.thead %}
                    {% block table.tbody %}
                        <tbody>
                        {% for row in table.page.object_list|default:table.rows %} {# support pagination #}
                            {% block table.tbody.row %}
                                <tr class="{% cycle "odd" "even" %}"
                                    data-href="{{ row.attrs.data_href }}"
                                    editable-list-model="{{ row.record|get_class_name }}"
                                    editable-list-object="{{ row.record.id }}">
                                    {% for column, cell in row.items %}
                                        <td {{ column.attrs.td.as_html }}
                                            {% if column.attrs.editable %}editable-list-enabled{% endif %}
                                            {% if column.attrs.mask %}input-mask="{{ column.attrs.mask }}"{% endif %}
                                            {{ column.attrs.td.as_html }}
                                            editable-list-column-name="{{ column.name }}">{{ cell }}</td>
                                    {% endfor %}
                                </tr>
                            {% endblock table.tbody.row %}
                        {% empty %}
                            {% if table.empty_text %}
                                {% block table.tbody.empty_text %}
                                    <tr>
                                        <td colspan="{{ table.columns|length }}">{{ table.empty_text }}</td>
                                    </tr>
                                {% endblock table.tbody.empty_text %}
                            {% endif %}
                        {% endfor %}
                        </tbody>
                    {% endblock table.tbody %}
                    {% block table.tfoot %}
                        <tfoot></tfoot>
                    {% endblock table.tfoot %}
                </table>
            </div>
            <div class="pagination-fixed">
                {% if table.page %}
                    {% block pagination %}
                        {% bootstrap_pagination table.page url=request.get_full_path %}
                    {% endblock pagination %}
                {% endif %}
            </div>
            <div class="text-right" style="margin: auto">
                <div class="fixed-btn">
                    {% if editable_list %}
                        <a class="btn btn-fab btn-primary" href="#" editable-list-btn-edit>
                            <i class="material-icons">mode_edit</i>
                        </a>
                        <a class="btn btn-fab btn-primary" href="#" editable-list-btn-save style="display: none">
                            <i class="material-icons">save</i>
                        </a>
                    {% endif %}

                    <input type="button" data-toggle="modal" data-target="#confirmDelete" disabled id="delete_button"
                           class="btn btn-fab btn-warning material-icons"
                           value="remove">
                    <a class="btn btn-fab btn-primary" href="{% if link_add_url %}{{ link_add_url }}{% elif link_add %}{% url link_add %}{% endif %}">
                        <i class="material-icons">add</i>
                    </a>
                </div>
            </div>
        </div>
    {% endblock table %}
    <!-- Modal -->
    <div id="confirmDelete" class="modal">
        <div class="modal-dialog">
            <div class="modal-content ">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title"><i class="material-icons">warning</i></h4>
                    <h4 class="modal-title">Atenção!</h4>
                </div>
                <div class="modal-body">
                    {% if on_delete == 'CASCADE' %}
                        <p>Ao excluir o(s) registro(s) de {{ form_name.title }} todos os seus vínculos também
                            serão excluídos! Essa ação é irreversível. Deseja continuar?</p>
                    {% else %}
                        <p>Tem certeza que deseja excluir o(s) registro(s)
                            de {{ form_name.title }} selecionado(s)? Essa ação é irreversível. Deseja continuar?</p>
                    {% endif %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Sim</button>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock content %}
