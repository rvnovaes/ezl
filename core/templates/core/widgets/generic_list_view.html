{% extends 'skeleton/base.html' %}
{% load render_table from django_tables2 %}
{% load static %}
{% load querystring from django_tables2 %}
{% load bootstrap3 %}
{% load core_filters %}

{% block extra_stylesheets %}
    <style>
        tr {
            cursor: pointer;
        }
    </style>
{% endblock extra_stylesheets %}
{% block extrajs %}
    {{ block.super }}
    <script src="{% static "js/editable-list.js" %}?rev={{request.REVIEW}}"></script>
{% endblock %}

{% block content %}
    {% if table.page %}
        <div class="table-container">
    {% endif %}
{% block search %} 
    {% include 'core/widgets/generic_search_view.html' %}
{% endblock%}
    {% if link_ex %}
    <form action="{% url link_ex %}" method="post" id="formTable">
    {% else %}
    <form action="#" method="post" id="formTable">
    {% endif %}
    {% csrf_token %}
    {% block table %}
        <div class="panel panel-default">
        <div class="panel-heading">
            <div class="panel-title form-row">{{ form_name_plural.capitalize }}</div>
        </div>
        <div class="panel-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover" paginate-fixed>
                    {% block table.thead %}
                        <thead>
                        <tr>
                            {% for column in table.columns %}
                                {% if column.orderable %}
                                    <th {{ column.attrs.th.as_html }}><a
                                            href="{% querystring table.prefixed_order_by_field=column.order_by_alias.next %}">{{ column.header|lower|capfirst }}</a>
                                    </th>
                                {% else %}
                                    {% if not column.attrs.selectable == True %}
                                        <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                    {% else %}
                                        <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </tr>
                        </thead>
                    {% endblock table.thead %}
                    {% block table.tbody %}
                        <tbody>
                        {% for row in table.page.object_list|default:table.rows %} {# support pagination #}
                            {% block table.tbody.row %}
                                <tr class="{% cycle "odd" "even" %}" data-href="{{ row.attrs.data_href }}">
                                    {% for column, cell in row.items %}
                                        <td {{ column.attrs.td.as_html }}>{{ cell }}</td>
                                    {% endfor %}
                                </tr>
                            {% endblock table.tbody.row %}
                        {% empty %}
                            {% if table.empty_text %}
                                {% block table.tbody.empty_text %}
                                    <tr>
                                        <td colspan="{{ table.columns|length }}">{{ table.empty_text }}</td>
                                    </tr>
                                {% endblock table.tbody.empty_text %}
                            {% endif %}
                        {% endfor %}
                        </tbody>
                    {% endblock table.tbody %}
                    {% block table.tfoot %}
                        <tfoot></tfoot>
                    {% endblock table.tfoot %}
                </table>
            </div>
            <div class="pagination-fixed">
                {% if table.page %}
                    {% block pagination %}
                        {% bootstrap_pagination table.page url=request.get_full_path %}
                    {% endblock pagination %}
                {% endif %}
            </div>
            <div class="text-right" style="margin: auto">
                <div class="fixed-btn">
                    <button type="button" data-toggle="modal" disabled id="delete_button"
                           class="btn btn-danger"
                            value="remove">Remover</button>
                </div>
            </div>
        </div>
    {% endblock table %}
    <!-- Modal -->
    <div id="confirmDelete" class="modal">
        <div class="modal-dialog">
            <div class="modal-content ">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title"><i class="fa fa-trash"></i></h4>
                    <h4 class="modal-title">Atenção!</h4>
                </div>
                <div class="modal-body">
                    {% if on_delete == 'CASCADE' %}
                        <p>Ao excluir o(s) registro(s) de {{ form_name.title }} todos os seus vínculos também
                            serão excluídos! Essa ação é irreversível. Deseja continuar?</p>
                    {% else %}
                        <p>Tem certeza que deseja excluir o(s) registro(s)
                            de {{ form_name.title }} selecionado(s)? Essa ação é irreversível. Deseja continuar?</p>
                    {% endif %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Sim</button>
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock content %}
{% block extra_scripts %}
    <script language="JavaScript">
        $('#myModal').modal('show')
        var pk_list = [];

        function toggle(source) {


            checkboxes = document.getElementsByName('selection');
            for (var i in checkboxes) {

                if (checkboxes.hasOwnProperty(i)) {
                    checkboxes[i].checked = source.checked;
                    if (source.checked)
                        pk_list.push(checkboxes[i].id);
                    else
                        pk_list = []
                }
            }
            if (pk_list.length > 0) {
                document.getElementById('delete_button').disabled = false;
            } else {
                document.getElementById('delete_button').disabled = true;
            }
        }

        function showDeleteButton(source) {
            if (source.checked) {
                pk_list.push(source.id);
            } else {
                pk_list.pop();
                document.getElementById("selection_header").checked = false;
            }

            if (pk_list.length > 0)
                document.getElementById('delete_button').disabled = false;
            else
                document.getElementById('delete_button').disabled = true;

        }

        $('#delete_button').click(function(){
            {% if on_delete == 'CASCADE' %}
                var text = "Ao excluir o(s) registro(s) selecionado(s), todos os seus " +
                    "vínculos também serão excluídos! Essa ação é irreversível";
            {% else %}
                var text = "Tem certeza que deseja excluir o(s) registro(s) selecionado(s)? " +
                    "Essa ação é irreversível.";
            {% endif %}

            swal({
                title: "Excluir?",
                text: text,
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Sim, desejo excluir",
                cancelButtonText: "Cancelar"
            }).then(function(result){
                if (result.value) {
                    $('#formTable').submit()                    
                }
            });
        });
    </script>
{% endblock %}
{% block bar_buttons %}
    {% if link_add %}
        <a class="btn btn-success pull-right m-l-20 waves-effect waves-light" href="{% if link_add_url %}{{ link_add_url }}{% elif link_add %}{% url link_add %}{% endif %}">
            Adicionar
        </a>
    {% endif %}
{% endblock %}