{% extends 'inicial.html' %}
{% load staticfiles %}
{#{% load formset_tags %}#}

{% block content %}
    {% include 'core/widgets/messages.html' %}
    <script src="{% static "libs/jquery-mask-plugin/jquery.mask.min.js" %}"></script>
    <style>
        #label_id_is_active, #id_is_active, #update_id_address {
            display: none !important;
        }
    </style>

    {#    Este form, deve ter o índice 0, favor não alterar a ordem dos forms deste arquivo#}
    <form id="person_form" action="" method="post">{% csrf_token %}

        <div style="display: none;">
            <input type="text" id="inp_delete" name="is_delete" value="0"/>
        </div>

        <div>
            <div>
                <div class="row">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <h1 class="panel-title text-center">{{ form.title }}</h1>
                        </div>
                        <div class="panel-body">

                            <div class="row">
                                {% for field in form %}
                                    {% if field.name == 'legal_name' %}
                                        <div class="col-sm-3">
                                            <div class="form-group">
                                                <label>{{ field.label }}{{ field }}</label>
                                            </div>
                                        </div>

                                    {% elif field.name == 'name' %}
                                        <div class="col-sm-3">
                                            <div class="form-group">
                                                <label>{{ field.label }}{{ field }}</label>
                                            </div>
                                        </div>

                                    {% elif field.name == 'auth_user' %}
                                        <div class="col-sm-2">
                                            <div class="form-group">
                                                <label>{{ field.label }}{{ field }}</label>
                                            </div>
                                        </div>

                                    {% elif field.name == 'legal_type' %}
                                        <div class="col-sm-2">
                                            <div class="form-group">
                                                <label id="id_legal_type_label">{{ field.label }}</label>
                                                {{ field }}
                                            </div>
                                        </div>


                                    {% elif field.name == 'cpf' %}
                                        <div class="col-sm-2 cpf-display">
                                            <div id="cpf_container"
                                                 class="form-group {% if form.instance.legal_type == 'J' %} hidden {% endif %}">
                                                <div class="form-group">
                                                    <label>{{ field.label }}{{ field }}</label>
                                                </div>
                                            </div>
                                        </div>


                                    {% elif field.name == 'cnpj' %}
                                        <div class="col-sm-2 cnpj-display" style="display: none">
                                            <div id="cnpj_container"
                                                 class="form-group {% if form.instance.legal_type == 'F' or not form.instance.id %}
                                                  hidden {% endif %}">
                                                <label>{{ field.label }}{{ field }}</label>
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="col-sm-3">
                                            <div class="form-group">
                                                <label>{{ field.label }}{{ field }}</label>
                                            </div>
                                        </div>

                                        {#                                    {% elif field.name == 'is_lawyer' %}#}
                                        {#                                        <div class="col-sm-2">#}
                                        {#                                                <label>#}
                                        {#                                                    {{ field.label }}{{ field }}#}
                                        {##}
                                        {#                                                </label>#}
                                        {#                                        </div>#}
                                        {#                                    {% elif field.name == 'is_correspondent' %}#}
                                        {#                                        <div class="col-sm-2">#}
                                        {#                                                <label>#}
                                        {#                                                    {{ field.label }}{{ field }}#}
                                        {##}
                                        {#                                                </label>#}
                                        {#                                        </div>#}
                                        {##}
                                        {#                                    {% elif field.name == 'is_court' %}#}
                                        {#                                        <div class="col-sm-2">#}
                                        {#                                                <label>#}
                                        {#                                                    {{ field.label }}{{ field }}#}
                                        {##}
                                        {#                                                </label>#}
                                        {#                                        </div>#}
                                        {##}
                                        {#                                    {% elif field.name == 'is_customer' %}#}
                                        {#                                        <div class="col-sm-2">#}
                                        {#                                                <label>#}
                                        {#                                                    {{ field.label }}{{ field }}#}
                                        {##}
                                        {#                                                </label>#}
                                        {#                                        </div>#}
                                        {##}
                                        {##}
                                        {#                                    {% elif field.name == 'is_supplier' %}#}
                                        {#                                        <div class="col-sm-2">#}
                                        {#                                                <label>#}
                                        {#                                                    {{ field.label }}{{ field }}#}
                                        {##}
                                        {#                                                </label>#}
                                        {#                                        </div>#}
                                        {#                                    {% elif field.name == 'is_active' %}#}
                                        {#                                        <div class="col-sm-2">#}
                                        {#                                                <label>#}
                                        {#                                                    {{ field.label }}{{ field }}#}
                                        {##}
                                        {#                                                </label>#}
                                        {#                                        </div>#}
                                    {% endif %}
                                {% endfor %}
                            </div>


                            <div id="fields_formset" style="display: none;">
                                <p id="extra_fields"></p>

                                <input type="text" name="address_set-INITIAL_FORMS"
                                       id="form_management_initial_forms"
                                       class="form-control" maxlength="255" value="0">

                                <input type="text" name="address_set-MAX_NUM_FORMS"
                                       id="form_management_max_num_forms"
                                       class="form-control" maxlength="255" value="1000">

                                <input type="text" name="address_set-TOTAL_FORMS"
                                       id="form_management_total_forms"
                                       class="form-control" maxlength="255" value="{{ addresses|length }}">

                                {% for address in addresses %}

                                    <input type="text" name="address_set-{{ forloop.counter0 }}-id"
                                           id="id_address_set-{{ forloop.counter0 }}-id"
                                           class="form-control" maxlength="255"
                                           value="{% if address.id != None %}{{ address.id }}{% endif %}">

                                    <input type="text" name="address_set-{{ forloop.counter0 }}-street"
                                           id="id_address_set-{{ forloop.counter0 }}-street"
                                           class="form-control" maxlength="255" value="{{ address.street }}">

                                    <input type="text" name="address_set-{{ forloop.counter0 }}-number"
                                           id="id_address_set-{{ forloop.counter0 }}-number"
                                           class="form-control" maxlength="255" value="{{ address.number }}">

                                    <input type="text" name="address_set-{{ forloop.counter0 }}-complement"
                                           id="id_address_set-{{ forloop.counter0 }}-complement"
                                           class="form-control" maxlength="255" value="{{ address.complement }}">

                                    <input type="text" name="address_set-{{ forloop.counter0 }}-city_region"
                                           id="id_address_set-{{ forloop.counter0 }}-city_region"
                                           class="form-control" maxlength="255" value="{{ address.city_region }}">

                                    <input type="text" name="address_set-{{ forloop.counter0 }}-zip_code"
                                           id="id_address_set-{{ forloop.counter0 }}-zip_code"
                                           class="form-control" maxlength="255" value="{{ address.zip_code }}">

                                    <textarea name="address_set-{{ forloop.counter0 }}-notes" cols="40" rows="10"
                                              class="form-control"
                                              id="id_address_set-{{ forloop.counter0 }}-notes">{{ address.notes }}</textarea>

                                    <select name="address_set-{{ forloop.counter0 }}-country" class="form-control"
                                            id="id_address_set-{{ forloop.counter0 }}-country">
                                        <option value="{{ address.country.id }}" selected>{{ address.country }}</option>
                                    </select>

                                    <input type="text" name="address_set-{{ forloop.counter0 }}-state"
                                           id="id_address_set-{{ forloop.counter0 }}-state"
                                           value="{{ address.state.id }}">

                                    <input type="text" name="address_set-{{ forloop.counter0 }}-city"
                                           id="id_address_set-{{ forloop.counter0 }}-city"
                                           value="{{ address.city.id }}">

                                    <input type="checkbox" name="address_set-{{ forloop.counter0 }}-is_active"
                                           id="id_address_set-{{ forloop.counter0 }}-is_active"
                                            {% if address.is_active == True or address.is_active == 'on' %}
                                           checked
                                            {% endif %}
                                    >
                                    <input type="text" name="address_set-{{ forloop.counter0 }}-address_type"
                                           id="id_address_set-{{ forloop.counter0 }}-address_type"
                                           value="{{ address.address_type.id }}">
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="panel panel-primary">
            <div class="panel-heading">
                <h1 class="panel-title text-center">Endereços</h1>
            </div>

            <div class="panel-body">
                <div class="table-responsive">
                    <table id="addresses" class="table table-hover "
                           style="text-align:center !important; font-weight: 100 !important; font-size: unset;">
                        <thead>
                        <tr>
                            <th style="text-align: center;">Excluir</th>
                            <th style="text-align: center;">Logradouro</th>
                            <th style="text-align: center;">Nº</th>
                            <th style="text-align: center;">Complemento</th>
                            <th style="text-align: center;">Bairro</th>
                            <th style="text-align: center;">Cidade</th>
                            <th style="text-align: center;">Estado</th>
                            <th style="text-align: center;">CEP</th>
                            <th style="text-align: center;">País</th>
                            <th style="text-align: center;">Observação</th>
                            <th style="text-align: center;">Tipo</th>
                            <th>Ativo</th>
                            <th></th>
                        </tr>
                        </thead>

                        <tbody>

                        {% for address in addresses %}

                            {#                        Caso a lista Address venha de endereço que ainda não foi salvo, o mesmo não possuirá ID. #}
                            {#                        Assim, o índice na tabela deve ser pelo forloop.counter0 para recuperar corretamente as informações #}
                            {#                        ao atualizar o endereço ainda não salvo no BD#}

                            {% if address.id == None %}
                                <tr id="update_new_address row-{{ forloop.counter0 }}" onclick="update_new_address(0);"
                                    name="{{ forloop.counter0 }}"
                                    style="cursor: pointer;">

                                    <th style="text-align: center;" id="delete_checkbox">
                                        {% if address.id != None %}
                                            <label style="margin-top: -5px !important;">
                                                <div class="checkbox">
                                                    <input onchange="delete_buttom($(this).prop('checked'))"
                                                           type="checkbox"
                                                           name="address_set-{{ forloop.counter0 }}-DELETE"
                                                           id="id_address_set-{{ forloop.counter0 }}-DELETE"
                                                           class="delete_check">
                                                    <span class="checkbox-material">
                                    <span class="check"></span>
                                </span>
                                                </div>
                                            </label>
                                        {% endif %}
                                    </th>

                                    <th style="text-align: center; font-weight: 100;"
                                        id="street-{{ forloop.counter0 }}">{{ address.street }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="number-{{ forloop.counter0 }}">{{ address.number }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="complement-{{ forloop.counter0 }}">{{ address.complement }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="city_region-{{ forloop.counter0 }}">{{ address.city_region }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="city-{{ forloop.counter0 }}">{{ address.city }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="state-{{ forloop.counter0 }}">{{ address.state }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="zip_code-{{ forloop.counter0 }}">{{ address.zip_code }}</th>

                                    <th style="text-align: center; font-weight: 100;"
                                        id="country-{{ forloop.counter0 }}">{{ address.country }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="notes-{{ forloop.counter0 }}">{{ address.notes }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="address_type-{{ forloop.counter0 }}">{{ address.address_type }}</th>

                                    <th style="text-align: center; font-weight: 100;"
                                        id="is_active-{{ forloop.counter0 }}">

                                        {% if address.is_active == True or address.is_active == 'on' %}
                                            <i class="material-icons" style="font-size: larger;">check</i>
                                        {% else %}
                                            <i class="material-icons" style="font-size: larger;">close</i>
                                        {% endif %}

                                    </th>
                                </tr>
                            {% else %}
                                <tr id="row-{{ address.id }}" name="{{ forloop.counter0 }}"
                                    style="cursor: pointer;">

                                    <th style="text-align: center;" id="delete_checkbox">
                                        {% if address.id != None %}
                                            <label style="margin-top: -5px !important;">
                                                <div class="checkbox">
                                                    <input onchange="delete_buttom($(this).prop('checked'))"
                                                           type="checkbox"
                                                           name="address_set-{{ forloop.counter0 }}-DELETE"
                                                           id="id_address_set-{{ forloop.counter0 }}-DELETE"
                                                           class="delete_check">
                                                    <span class="checkbox-material">
                                    <span class="check"></span>
                                </span>
                                                </div>
                                            </label>
                                        {% endif %}
                                    </th>

                                    <th style="text-align: center; font-weight: 100;"
                                        id="street-{{ address.id }}" class="update_address">{{ address.street }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="number-{{ address.id }}" class="update_address">{{ address.number }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="complement-{{ address.id }}"
                                        class="update_address">{{ address.complement }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="city_region-{{ address.id }}"
                                        class="update_address">{{ address.city_region }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="city-{{ address.id }}" class="update_address">{{ address.city }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="state-{{ address.id }}" class="update_address">{{ address.state }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="zip_code-{{ address.id }}"
                                        class="update_address">{{ address.zip_code }}</th>

                                    <th style="text-align: center; font-weight: 100;"
                                        id="country-{{ address.id }}" class="update_address">{{ address.country }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="notes-{{ address.id }}" class="update_address">{{ address.notes }}</th>
                                    <th style="text-align: center; font-weight: 100;"
                                        id="address_type-{{ address.id }}"
                                        class="update_address">{{ address.address_type }}</th>

                                    <th style="text-align: center; font-weight: 100;"
                                        id="is_active-{{ address.id }}" class="update_address">

                                        {% if address.is_active == True or address.is_active == 'on' %}
                                            <i class="material-icons" style="font-size: larger;">check</i>
                                        {% else %}
                                            <i class="material-icons" style="font-size: larger;">close</i>
                                        {% endif %}

                                    </th>
                                </tr>
                            {% endif %}
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="modal fade" id="modal-wait" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title" style="text-align: center">Aguarde ...</h4>
                            </div>
                            <div class="modal-body">
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" style="width: 100%;">100%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal" id="form_address_update">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"
                                        aria-hidden="true">
                                    ×
                                </button>
                                <h4 class="modal-title">Atualizar Endereço</h4>
                            </div>
                            <div class="modal-body">

                                <form action="" method="POST" id="form_new_address">
                                    <div id="message_error"></div>
                                    {% csrf_token %}

                                    <div class="row">

                                        <div class="col-sm-12">
                                            <div class="form-group">
                                                <label class="control-label" for="update_id_address_type">Tipo de
                                                    Endereço</label>
                                                <select name="address_type" required
                                                        id="update_id_address_type" class="form-control">
                                                    <option value=" " selected></option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="control-label" for="update_id_street">Logradouro</label>
                                                <input type="text" name="street" id="update_id_street"
                                                       class="form-control" maxlength="255" value=" "
                                                       required/>
                                            </div>
                                        </div>
                                        <div class="col-sm-3">
                                            <div class="form-group ">
                                                <label class="control-label" for="update_id_number">Número</label>
                                                <input type="text" name="number" id="update_id_number"
                                                       class="form-control" maxlength="255" value=" "
                                                       required/>
                                            </div>
                                        </div>
                                        <div class="col-sm-3">
                                            <div class="form-group ">
                                                <label class="control-label"
                                                       for="update_id_complement">Complemento</label>
                                                <input type="text" name="complement"
                                                       class="form-control" maxlength="255" value=" "
                                                       id="update_id_complement"/>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group ">
                                                <label class="control-label" for="update_id_city_region">Bairro</label>
                                                <input type="text" name="city_region"
                                                       id="update_id_city_region"
                                                       class="form-control" maxlength="255" value=" "
                                                       required/>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group ">
                                                <label class="control-label" for="update_id_zip_code">CEP</label>
                                                <input type="text" name="zip_code"
                                                       id="update_id_zip_code" value=" "
                                                       class="form-control" maxlength="255"
                                                       required/>
                                            </div>
                                        </div>

                                        <div class="col-sm-4">
                                            <div class="form-group ">
                                                <label class="control-label" for="update_id_country">País</label>
                                                <select name="country" id="update_id_country"
                                                        class="form-control" required>
                                                    <option value=" " selected></option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group ">
                                                <label class="control-label" for="update_id_state">Estado</label>
                                                <select name="state" id="update_id_state"
                                                        class="form-control" required>
                                                    <option value=" " selected></option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group ">
                                                <label class="control-label" for="update_id_city">Município</label>
                                                <select name="city" id="update_id_city"
                                                        class="form-control"
                                                        required>
                                                    <option value=" " selected></option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-sm-12">
                                            <div class="form-group ">
                                                <label class="control-label"
                                                       for="update_id_notes">Observação</label>
                                                <textarea name="notes" id="update_id_notes" cols="40"
                                                          rows="2" class="form-control">
                                                                    </textarea>
                                            </div>
                                        </div>


                                    </div>

                                    <div class="form-group ">
                                        <label class="control-label" for="update_id_is_active"
                                               id="label_update_id_is_active">Ativo</label>
                                        <label>
                                            <div class="checkbox" id="check">
                                                <input type="checkbox"
                                                       name="is_active"
                                                       id="update_id_is_active" class="delete_check">
                                                <span class="checkbox-material">
                                            <span class="check"></span>
                                        </span>
                                            </div>
                                        </label>
                                    </div>
                                    <input type="text" name="id"
                                           id="update_id_address"
                                           class="form-control input-sm" maxlength="255"/>
                                    <br><br><br>

                                    <div class="text-center">

                                        <input type="button"
                                               class="btn btn-raised btn-default"
                                               data-dismiss="modal"
                                               value="Cancelar"/>
                                        
                                        <input type="button" id="save_updated_address"
                                               class="btn btn-primary btn-raised"
                                               value="Atualizar">
                                    </div>


                                </form>
                            </div>
                            <div class="modal-footer">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-right" style="margin: auto">
                    <input type="button" data-toggle="modal" data-target="#confirmDelete" id="delete_button"
                           class="btn btn-fab btn-warning material-icons" value="remove"
                           style="height: 30px !important; width: 30px !important; min-width: 30px !important;"
                           onclick="can_delete_addresses()" disabled>

                    <a class="btn btn-fab btn-primary" href="#new_address"

                       onclick="$('#new_address').modal('show');"
                       style="height: 30px !important; width: 30px !important; min-width: 30px !important;">
                        <i class="material-icons">add</i></a>
                </div>
            </div>
        </div>
        <div style="text-align: center;">
            <input type="submit" class="btn btn-primary btn-raised"
                   onclick="document.getElementById('person_form').submit()" value="Salvar"/>

            <a class="btn btn-sm btn-raised btn-default" href="{% url 'person_list' %}">
                <i class="material-icons left">clear</i>
                Cancelar
                <div class="ripple-container"></div>
            </a>
        </div>
        <div class="modal" id="modal_message">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <p id="message_text" style="text-align: center;"></p>
                    </div>
                    <div class="modal-footer" style="text-align: center;">
                        <input type="button" data-dismiss="modal" value="OK"
                               class="btn btn-primary btn-raised"
                               style="max-width: 100px;"/>
                        <br>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="modal_redirect_page">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <p id="message_text_redirect_page" style="text-align: center;"></p>
                    </div>
                    <div class="modal-footer" style="text-align: center;">
                        <input type="button" data-dismiss="modal" value="OK"
                               class="btn btn-primary btn-raised"
                               style="max-width: 100px;"
                               id="btn_redirect_page"/>
                        <br>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="new_address">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            ×
                        </button>
                        <h4 class="modal-title">Adicionar Endereço</h4>
                    </div>
                    <div class="modal-body">
                        <div id="message_errors"></div>
                        <br>
                        <form action="" method="POST" id="form_new_address">
                            <div id="message_error"></div>
                            {% csrf_token %}
                            <div class="row">
                                {% for field in form_address %}

                                    {% if field.name == 'address_type' %}
                                        <div class="col-sm-12">
                                            <div class="form-group ">
                                                <label class="control-label"
                                                       required="">{{ field.label }}</label>
                                                {{ field }}
                                            </div>
                                        </div>
                                    {% elif field.name == 'street' %}
                                        <div class="col-sm-6">
                                            <div class="form-group  is-empty">
                                                <label class="control-label"
                                                       required="">{{ field.label }}</label>
                                                {{ field }}
                                            </div>
                                        </div>
                                    {% elif field.name == 'number' %}
                                        <div class="col-sm-3">
                                            <div class="form-group  is-empty">
                                                <label class="control-label"
                                                       required="">{{ field.label }}</label>
                                                {{ field }}
                                            </div>
                                        </div>
                                    {% elif field.name == 'complement' %}
                                        <div class="col-sm-3">
                                            <div class="form-group  is-empty">
                                                <label class="control-label"
                                                       required="">{{ field.label }}</label>
                                                {{ field }}
                                            </div>
                                        </div>
                                    {% elif field.name == 'city_region' %}
                                        <div class="col-sm-6">
                                            <div class="form-group  is-empty">
                                                <label class="control-label"
                                                       required="">{{ field.label }}</label>
                                                {{ field }}
                                            </div>
                                        </div>

                                    {% elif field.name == 'zip_code' %}
                                        <div class="col-sm-6">
                                            <div class="form-group  is-empty">
                                                <label class="control-label"
                                                       required="">{{ field.label }}</label>
                                                {{ field }}
                                            </div>
                                        </div>

                                    {% elif field.name == 'country' %}
                                        <div class="col-sm-4">
                                            <div class="form-group  is-empty">
                                                <label class="control-label"
                                                       required="">{{ field.label }}</label>
                                                {{ field }}
                                            </div>
                                        </div>

                                    {% elif field.name == 'state' %}
                                        <div class="col-sm-4">
                                            <div class="form-group  is-empty">
                                                <label class="control-label"
                                                       required="">{{ field.label }}</label>
                                                {{ field }}
                                            </div>
                                        </div>

                                    {% elif field.name == 'city' %}
                                        <div class="col-sm-4">
                                            <div class="form-group  is-empty">
                                                <label class="control-label"
                                                       required="">{{ field.label }}</label>
                                                {{ field }}
                                            </div>
                                        </div>

                                    {% elif field.name == 'notes' %}
                                        <div class="col-sm-12">
                                            <div class="form-group  is-empty">
                                                <label class="control-label"
                                                       required="">{{ field.label }}</label>
                                                {{ field }}
                                            </div>
                                        </div>
                                    {% endif %}

                                {% endfor %}
                            </div>
                            <br><br><br>

                            <input type="hidden" name="legal_type" id="id_new_legal_type"
                                   maxlength="255"
                                   class="form-control">

                            <input type="hidden" name="legal_name" id="id_new_legal_name"
                                   maxlength="255"
                                   class="form-control">

                            <div class="text-center">

                                <input type="button" class="btn btn-raised btn-default"
                                       data-dismiss="modal"
                                       value="Cancelar"/>

                                <input type="button" id="save_address"
                                       class="btn btn-primary btn-raised"
                                       value="Adicionar">


                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
        </div>
        </div>
        </div>
        </fieldset>
        </div>

    </form>

    <!-- Modal -->
    <div id="confirmDelete" class="modal">
        <div class="modal-dialog">
            <div class="modal-content ">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title"><i class="material-icons">warning</i></h4>
                    <h4 class="modal-title">Atenção!</h4>
                </div>
                <div class="modal-body">
                    Tem certeza que deseja excluir os endereços selecionados ?
                </div>
                <div class="modal-footer">

                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button onclick="document.forms[0].submit()" type="submit" class="btn btn-primary">Sim</button>

                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {

            document.getElementById("id_address_type").options[0].text = "";
            // Recupera todos os tipos de endereço
            $.ajax({
                url: '{% url 'addresses_types' %}',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    var obj = JSON.parse(data);
                    var length = obj.number;
                    document.getElementById("id_state").options.length = 0;

                    if (length == 0) {

                        document.getElementById("update_id_address_type").options.length = 0;
                        $('#update_id_address_type').append($('<option>', {
                            value: " ",
                            text: ""
                        }));

                    }

                    else {
                        for (i = 0; i < length; i++) {

                            $('#update_id_address_type').append($('<option>', {
                                value: obj.addresses_types[i].id,
                                text: obj.addresses_types[i].name
                            }));
                        }
                    }
                }
            });

            var url = '{% url 'address_country' %}';
            $.ajax({
                url: url,
                success: function (data) {
                    var obj = JSON.parse(data);
                    var length = obj.number;
                    document.getElementById("id_country").options.length = 0;
                    document.getElementById("update_id_country").options.length = 0;
                    document.getElementById("id_city").options.length = 0;
                    document.getElementById("update_id_city").options.length = 0;
                    document.getElementById("id_state").options.length = 0;
                    document.getElementById("update_id_state").options.length = 0;
                    for (i = 0; i < length; i++) {
                        if (i == 0) {
                            $('#id_country').append($('<option>', {
                                value: "",
                                text: ""
                            }));

                            $('#id_state').append($('<option>', {
                                value: "",
                                text: ""
                            }));

                            $('#id_city').append($('<option>', {
                                value: "",
                                text: ""
                            }));

                            $('#update_id_state').append($('<option>', {
                                value: "",
                                text: ""
                            }));

                            $('#update_id_city').append($('<option>', {
                                value: "",
                                text: ""
                            }));
                        }

                        $('#id_country').append($('<option>', {
                            value: obj.countries[i].id,
                            text: obj.countries[i].name
                        }));

                        $('#update_id_country').append($('<option>', {
                            value: obj.countries[i].id,
                            text: obj.countries[i].name
                        }));
                    }
                }
            })
        })
    </script>

    <script>
        $("#update_id_state").change(function () {
            ''
            var option = $(this).val();
            var url = '{% url 'address_city' 999 %}'.replace(999, option);
            $.ajax({
                url: url,
                success: function (data) {
                    var obj = JSON.parse(data);
                    var length = obj.number;
                    document.getElementById("update_id_city").options.length = 0;
                    if (length == 0) {

                        $('#id_city').append($('<option>', {
                            value: null,
                            text: ""
                        }));
                    }
                    else {

                        $('#update_id_city').append($('<option>', {
                            value: " ",
                            text: ""
                        }));

                        for (i = 0; i < length; i++) {

                            $('#update_id_city').append($('<option>', {
                                value: obj.cities[i].id,
                                text: obj.cities[i].name
                            }));
                        }

                        $('#update_id_city :nth-child(1)').prop('selected', true).change();
                    }
                }
            })
        })
    </script>

    <script>
        $("#id_state").change(function () {
            var option = $(this).val();
            var url = '{% url 'address_city' 999 %}'.replace(999, option);
            $.ajax({
                url: url,
                success: function (data) {
                    var obj = JSON.parse(data);
                    var length = obj.number;
                    document.getElementById("id_city").options.length = 0;

                    if (length == 0) {

                        $('#id_city').append($('<option>', {
                            value: null,
                            text: ""
                        }));
                    }
                    else {

                        $('#update_id_city').append($('<option>', {
                            value: " ",
                            text: ""
                        }));

                        for (i = 0; i < length; i++) {

                            $('#id_city').append($('<option>', {
                                value: obj.cities[i].id,
                                text: obj.cities[i].name
                            }));
                        }

                        $('#id_city :nth-child(1)').prop('selected', true).change();
                    }
                }
            })
        })
    </script>

    <script>
        $("#update_id_country").change(function () {

            var option = $(this).val();
            var url = '{% url 'address_state' 999 %}'.replace(999, option);
            $.ajax({
                url: url,
                success: function (data) {

                    var obj = JSON.parse(data);
                    var length = obj.number;
                    document.getElementById("update_id_state").options.length = 0;

                    if (length == 0) {

                        document.getElementById("update_id_city").options.length = 0;
                        $('#update_id_state').append($('<option>', {
                            value: null,
                            text: ""
                        }));

                        $('#update_id_city').append($('<option>', {
                            value: null,
                            text: ""
                        }));
                    }

                    else {
                        for (i = 0; i < length; i++) {

                            $('#update_id_state').append($('<option>', {
                                value: obj.states[i].id,
                                text: obj.states[i].name
                            }));
                        }

                        $('#update_id_state :nth-child(1)').prop('selected', true).change();


                    }
                }
            })
        })
    </script>

    <script>
        $("#id_country").change(function () {
            var option = $(this).val();
            var url = '{% url 'address_state' 999 %}'.replace(999, option);
            $.ajax({
                url: url,
                success: function (data) {
                    var obj = JSON.parse(data);
                    var length = obj.number;
                    document.getElementById("id_state").options.length = 0;

                    if (length == 0) {

                        document.getElementById("id_city").options.length = 0;
                        $('#id_city').append($('<option>', {
                            value: null,
                            text: ""
                        }));

                        $('#id_state').append($('<option>', {
                            value: null,
                            text: ""
                        }));
                    }

                    else {
                        for (i = 0; i < length; i++) {

                            $('#id_state').append($('<option>', {
                                value: obj.states[i].id,
                                text: obj.states[i].name
                            }));
                        }
                        $('#id_state :nth-child(1)').prop('selected', true).change();

                    }
                }
            })
        })
    </script>

    <script>
        function update_new_address(id) {

            address_type = $("#address_type-" + id).text();
            val_address_type = $("#update_id_address_type").find("option:contains(" + address_type + ")").val();
            $('#update_id_address_type').val(val_address_type);
            $('#update_id_address').val(id);
            $('#update_id_street').val($('#street-' + id).text());
            $('#update_id_number').val($('#number-' + id).text());
            $('#update_id_complement').val($('#complement-' + id).text());
            $('#update_id_city_region').val($('#city_region-' + id).text());
            $('#update_id_notes').val($('#notes-' + id).text());
            $('#update_id_zip_code').val($('#zip_code-' + id).text());

            country = $("#country-" + id).text();
            val_country = $("#update_id_country").find("option:contains(" + country + ")").val();
            $('#update_id_country').val(val_country).change();

            setTimeout(function () {
                $("#modal-wait").modal('show');
                state = $("#state-" + id).text();
                val_state = $("#update_id_state").find("option:contains(" + state + ")").val();
                $('#update_id_state').val(val_state).change();
            }, 1500);

            setTimeout(function () {
                city = $("#city-" + id).text();
                val_city = $("#update_id_city").find("option:contains(" + city + ")").val();
                $('#update_id_city').val(val_city).change();
                $("#update_id_is_active").prop('checked', true);
                document.getElementById("label_update_id_is_active").style = "display: none;";
                document.getElementById("check").style = "display: none;";

                $("#modal-wait").modal('hide');

                setTimeout(function () {
                    $('#form_address_update').modal('show');
                }, 500);

            }, 3000);
        }
    </script>

    <script>
        $(".update_address").click(function () {

            var n = (this).id.indexOf("-");
            var id = (this).id.slice(n + 1);
            var url = '{% url 'person_address_information' 999 %}'.replace(999, id);

            $.ajax({
                url: url,
                type: 'GET',
                dataType: 'json',
                success: function (data) {

                    $('#update_id_address_type').val(data.address_type_id);
                    $('#update_id_address').val(id);
                    $('#update_id_street').val(data.street);
                    $('#update_id_number').val(data.number);
                    $('#update_id_complement').val(data.complement);
                    $('#update_id_city_region').val(data.city_region);
                    $('#update_id_notes').val(data.notes);
                    $('#update_id_zip_code').val(data.zip_code);


                    $('#update_id_country').val("0").trigger("click");
                    $('#update_id_country').val(data.country_id).trigger("change");

                    setTimeout(function () {
                        $("#modal-wait").modal('show');
                        $('#update_id_state').val(data.state_id).change();
                    }, 1000);

                    setTimeout(function () {
                        $('#update_id_city').val(data.city_id).change();

                        if (data.is_active)
                            $('#update_id_is_active').prop('checked', true);

                        else
                            $('#update_id_is_active').prop('checked', false);

                        $("#modal-wait").modal('hide');

                        setTimeout(function () {
                            $('#form_address_update').modal('show');
                        }, 500);


                    }, 2000);
                }
            });
        })
    </script>

    <script>
        function getCookie(c_name) {
            if (document.cookie.length > 0) {
                c_start = document.cookie.indexOf(c_name + "=");
                if (c_start != -1) {
                    c_start = c_start + c_name.length + 1;
                    c_end = document.cookie.indexOf(";", c_start);
                    if (c_end == -1) c_end = document.cookie.length;
                    return unescape(document.cookie.substring(c_start, c_end));
                }
            }
            return "";
        }

        $("#save_updated_address").click(function () {

            id = $('#update_id_address').val();

            //formset_index = $("#row-" + id).attr('name');
            formset_index = $("tr[id*='row-" + id + "']").attr('name');
            street = $("#update_id_street").val();
            number_person = $("#update_id_number").val();
            complement = $("#update_id_complement").val();
            city_region = $("#update_id_city_region").val();
            zip_code = $("#update_id_zip_code").val();
            notes = $("#update_id_notes").val();
            country = $("#update_id_country").val();
            country_text = $("#update_id_country option:selected").text();
            state = $("#update_id_state").val();
            state_text = $("#update_id_state option:selected").text();
            city = $("#update_id_city").val();
            city_text = $("#update_id_city option:selected").text();
            csrf_token = $("#csrfmiddlewaretoken").val();
            address_type = $("#update_id_address_type").val();
            address_type_text = $("#update_id_address_type option:selected").text();
            is_active = $("#update_id_is_active").prop('checked');

            var message = "Os seguintes campos não podem estar vazios: <ul>";
            var is_valid = true;


            if (address_type === null || address_type === "") {
                message = message + "<li>Tipo de Endereço</li>";
                is_valid = false;
            }

            if (street === null || street === "") {
                message = message + "<li>Logradouro</li>";
                is_valid = false;
            }

            if (number_person === null || number_person === "") {
                message = message + "<li>Número</li>";
                is_valid = false;
            }

            if (city_region === null || city_region === "") {
                message = message + "<li>Bairro</li>";
                is_valid = false;
            }

            if (zip_code === null || zip_code === "") {
                message = message + "<li>CEP</li>";
                is_valid = false;
            }

            if (country === null || country === "") {
                message = message + "<li>País</li>";
                is_valid = false;
            }

            if (state === null || state === "") {
                message = message + "<li>Estado</li>";
                is_valid = false;
            }

            if (city === null || city === "") {
                message = message + "<li>Cidade</li>";
                is_valid = false;
            }

            message = message + "</ul>";

            if (is_valid) {

                $("#street-" + id).text($("#update_id_street").val());
                $("#id_address_set-" + formset_index + "-street").val($("#update_id_street").val());

                $("#number-" + id).text($("#update_id_number").val());
                $("#id_address_set-" + formset_index + "-number").val($("#update_id_number").val());

                $("#complement-" + id).text($("#update_id_complement").val());
                $("#id_address_set-" + formset_index + "-complement").val($("#update_id_complement").val());

                $("#city_region-" + id).text($("#update_id_city_region").val());
                $("#id_address_set-" + formset_index + "-city_region").val($("#update_id_city_region").val());

                $("#zip_code-" + id).text($("#update_id_zip_code").val());
                $("#id_address_set-" + formset_index + "-zip_code").val($("#update_id_zip_code").val());

                $("#city-" + id).text(city_text);
                $("#id_address_set-" + formset_index + "-city").val($("#update_id_city").val());

                $("#state-" + id).text(state_text);
                $("#id_address_set-" + formset_index + "-state").val($("#update_id_state").val());

                {#            $("#update_id_state").val()#}

                $("#country-" + id).text(country_text);
                $("#id_address_set-" + formset_index + "-country").val($("#update_id_country").val());

                is_active = $("#update_id_is_active").prop('checked');

                if (is_active || is_active === "on") {
                    $("#is_active-" + id).text("");
                    $("#id_address_set-" + formset_index + "-is_active").prop('checked', true);
                    $("#is_active-" + id).append("<i class='material-icons' style='font-size: larger;'>check</i>");
                }
                else {
                    $("#is_active-" + id).text("");
                    $("#id_address_set-" + formset_index + "-is_active").prop('checked', false);
                    $("#is_active-" + id).append("<i class='material-icons' style='font-size: larger;'>close</i>");
                }

                $("#address_type-" + id).text(address_type_text);
                $("#id_address_set-" + formset_index + "-address_type").val($("#update_id_address_type").val());

                $("#notes-" + id).text($("#update_id_notes").val());
                $("#id_address_set-" + formset_index + "-notes").val($("#update_id_notes").val());

                document.getElementById("message_text").innerHTML = "Endereço atualizado com sucesso";
                $('#form_address_update').modal('hide');
                $('#modal_message').modal('show');
            }

            else {

                document.getElementById("message_error").innerHTML = '<div class="alert alert-danger">' +
                    message +
                    '</div>';
                $('#form_address_update').animate({scrollTop: 0}, 'slow');
            }

        });
    </script>

    <script type="text/javascript">

        function getCookie(c_name) {
            if (document.cookie.length > 0) {
                c_start = document.cookie.indexOf(c_name + "=");
                if (c_start != -1) {
                    c_start = c_start + c_name.length + 1;
                    c_end = document.cookie.indexOf(";", c_start);
                    if (c_end == -1) c_end = document.cookie.length;
                    return unescape(document.cookie.substring(c_start, c_end));
                }
            }
            return "";
        }

        $(document).ready(function () {

            var num_addresses = ({{ addresses|length }}) - 1;

            $("#save_address").click(function () {


                num_addresses++;

                $("#form_management_total_forms").val(String(num_addresses + 1));
                street = $("#id_street").val();
                number_person = $("#id_number").val();
                complement = $("#id_complement").val();
                city_region = $("#id_city_region").val();
                zip_code = $("#id_zip_code").val();
                notes = $("#id_notes").val();
                {#                home_address = $("#id_home_address").prop('checked');#}
                {#                business_address = $("#id_business_address").prop('checked');#}
                country = $("#id_country option:selected").text();
                country_id = $("#id_country option:selected").val();
                state = $("#id_state option:selected").text();
                state_id = $("#id_state option:selected").val();
                city = $("#id_city option:selected").text();
                city_id = $("#id_city option:selected").val();
                csrf_token = $("#csrfmiddlewaretoken").val();
                address_type = $("#id_address_type option:selected").text();
                address_type_id = $("#id_address_type option:selected").val();
                vlegal_type = $("#id_new_legal_type").val();
                legal_name = $("#id_new_legal_name").val();
                name = $("#id_name").val();
                is_lawyer = $("#id_is_lawyer").prop('checked');
                is_correspondent = $("#id_is_correspondent").prop('checked');
                is_court = $("#id_is_court").prop('checked');
                vcpf = $("#id_cpf").val();
                vcnpj = $("#id_cnpj").val();
                auth_user = $("#id_auth_user").val();
                is_active = $("#id_is_active").prop('checked');
                is_customer = $("#id_is_customer").prop('checked');
                is_supplier = $("#id_is_supplier").prop('checked');

                var message = "Os seguintes campos não podem estar vazios:<ul> ";
                var is_valid = true;


                if (address_type_id === null || address_type_id === "") {
                    message = message + "<li>Tipo de Endereço</li> ";
                    is_valid = false;
                }

                if (street === null || street === "") {
                    message = message + "<li>Logradouro</li>";
                    is_valid = false;
                }

                if (number_person === null || number_person === "") {
                    message = message + "<li>Número</li>";
                    is_valid = false;
                }

                if (city_region === null || city_region === "") {
                    message = message + "<li>Bairro</li>";
                    is_valid = false;
                }

                if (zip_code === null || zip_code === "") {
                    message = message + "<li>CEP</li>";
                    is_valid = false;
                }

                if (country_id === null || country_id === "") {
                    message = message + "<li>País</li>";
                    is_valid = false;
                }

                if (state_id === null || state_id === "") {
                    message = message + "<li>Estado</li>";
                    is_valid = false;
                }

                if (city_id === null || city_id === "") {
                    message = message + "<li>Cidade</li>";
                    is_valid = false;
                }
                message = message + "</ul>";

                if (is_valid) {
                    var table = document.getElementById("addresses");
                    var row = table.insertRow(1);
                    row.id = 'update_new_address row-' + num_addresses;
                    //row.setAttribute('id', 'update_new_address row-' + num_addresses);
                    row.setAttribute('name', num_addresses);
                    row.setAttribute('onclick', 'update_new_address(' + num_addresses + ');');
                    row.style = 'cursor: pointer;';

                    var cel1 = row.insertCell(0).innerHTML = "";
                    var cel1 = row.insertCell(1);
                    cel1.id = 'street-' + num_addresses;
                    cel1.innerHTML = street;

                    var cel2 = row.insertCell(2);
                    cel2.id = 'number-' + num_addresses;
                    cel2.innerHTML = number_person;

                    var cel3 = row.insertCell(3);
                    cel3.id = 'complement-' + num_addresses;
                    cel3.innerHTML = complement;

                    var cel4 = row.insertCell(4);
                    cel4.id = 'city_region-' + num_addresses;
                    cel4.innerHTML = city_region;

                    var cel5 = row.insertCell(5);
                    cel5.id = 'city-' + num_addresses;
                    cel5.innerHTML = city;

                    var cel6 = row.insertCell(6);
                    cel6.id = 'state-' + num_addresses;
                    cel6.innerHTML = state;

                    var cel7 = row.insertCell(7);
                    cel7.id = 'zip_code-' + num_addresses;
                    cel7.innerHTML = zip_code;

                    var cel10 = row.insertCell(8);
                    cel10.id = 'country-' + num_addresses;
                    cel10.innerHTML = country;

                    var cel11 = row.insertCell(9);
                    cel11.id = 'notes-' + num_addresses;
                    cel11.innerHTML = notes;

                    var cel12 = row.insertCell(10);
                    cel12.id = 'address_type-' + num_addresses;
                    cel12.innerHTML = address_type;

                    var cel12 = row.insertCell(11);
                    cel12.id = 'is_active-' + num_addresses;
                    cel12.innerHTML = "<i class='material-icons' style='font-size: larger;'>check</i>";


                    var cel13 = row.insertCell(12).innerHTML = "";
                    cel13.id = '' + num_addresses;

                    //Gera os campos para o FormSet
                    $('form#person_form').append('<input type="text" name="address_set-' + num_addresses + '-street" id="id_address_set-' + num_addresses + '-street" value="' + street + '" style="display:none;"">');
                    $('form#person_form').append('<input type="text" name="address_set-' + num_addresses + '-number" id="id_address_set-' + num_addresses + '-number" value="' + number_person + '" style="display:none;"">');
                    $('form#person_form').append('<input type="text" name="address_set-' + num_addresses + '-complement" id="id_address_set-' + num_addresses + '-complement" value="' + complement + '" style="display:none;">');
                    $('form#person_form').append('<input type="text" name="address_set-' + num_addresses + '-city_region" id="id_address_set-' + num_addresses + '-city_region" value="' + city_region + '" style="display:none;">');
                    $('form#person_form').append('<input type="text" name="address_set-' + num_addresses + '-zip_code" id="id_address_set-' + num_addresses + '-zip_code" value="' + zip_code + '" style="display:none;">');
                    $('form#person_form').append('<textarea name="address_set-' + num_addresses + '-notes" cols="40" rows="10" id="id_address_set-' + num_addresses + '-notes" style="display:none;">' + notes + '</textarea>');

                    $('form#person_form').append('<input type="text" name="address_set-' + num_addresses + '-state" id="id_address_set-' + num_addresses + '-state" value="' + state_id + '" style="display:none;"">');
                    $('form#person_form').append('<input type="text" name="address_set-' + num_addresses + '-city" id="id_address_set-' + num_addresses + '-city" value="' + city_id + '" style="display:none;"">');
                    $('form#person_form').append('<input type="text" name="address_set-' + num_addresses + '-country" id="id_address_set-' + num_addresses + '-country" value="' + country_id + '" style="display:none;"">');
                    $('form#person_form').append('<input type="text" name="address_set-' + num_addresses + '-address_type" id="id_address_set-' + num_addresses + '-address_type" value="' + address_type_id + '" style="display:none;"">');

                    if (is_active)
                        $('form#person_form').append('<input type="checkbox" name="address_set-' + num_addresses + '-is_active" id="id_address_set-' + num_addresses + '-is_active" checked style="display:none;">');

                    else
                        $('form#person_form').append('<input type="checkbox" name="address_set-' + num_addresses + '-is_active" id="id_address_set-' + num_addresses + '-is_active" style="display:none;">');

                    $('#new_address').modal('hide');
                    document.getElementById("message_text").innerHTML = "Endereço adicionado com successo";
                    $('#modal_message').modal('show');

                    $("#id_address_type").val($("#id_address_type option:first").val());
                    $("#id_country").val($("#id_country option:first").val());
                    $("#id_state").empty();
                    $("#id_city").empty();
                    $('#id_state').append($('<option>', {
                        value: " ",
                        text: "Selecione"
                    }));
                    $('#id_city').append($('<option>', {
                        value: " ",
                        text: "Selecione"
                    }));

                    // Limpa o formulario e volta ao estado original
                    $('#id_street').val(null);
                    $('#id_number').val(null);
                    $('#id_complement').val(null);
                    $('#id_city_region').val(null);
                    $('#id_zip_code').val(null);
                    $('#id_notes').val(null);

                    $('#id_number').val(null);
                    $('#id_number').val(null);
                    $('#id_number').val(null);
                    $('#id_number').val(null);
                    $('#update_id_number').value = null;
                }

                else {

                    document.getElementById("message_errors").innerHTML = '<div class="alert alert-danger">' +
                        message +
                        '</div>';
                    $('#new_address').animate({scrollTop: 0}, 'slow');
                }
            });
        });
    </script>

    <script>

    </script>

    <script>
        var itens_checked_to_delete = 0;

        function delete_buttom(check) {
            is_delete = document.getElementById("inp_delete");
            if (check) {
                itens_checked_to_delete++;
            }
            else {
                itens_checked_to_delete--;
            }

            if (itens_checked_to_delete === 0) {
                is_delete.value = "0";
                document.getElementById('delete_button').disabled = true;
            }
            else {
                is_delete.value = "1";
                document.getElementById('delete_button').disabled = false;
            }
        }

        function can_delete_addresses() {
            is_delete = document.getElementById("inp_delete");

            if (is_delete.value === '1') {
                is_delete.value = "3";
            }

        }
    </script>
    <script type="text/javascript">
        $(function () {

            $('#id_cnpj').mask('00.000.000/0000-00', {reverse: true});
            $('#id_cpf').mask('000.000.000-00', {reverse: true});

        });

        var legal_type = document.getElementById('id_legal_type');

        var div_cnpj = document.getElementById("cnpj_container");
        var div_cpf = document.getElementById("cpf_container");

        var cnpj = document.getElementById('id_cnpj');
        var cpf = document.getElementById('id_cpf');

        if (legal_type.getAttribute('value') === 'J')
            cnpj.required = true;
        else if (legal_type.getAttribute('value') === 'F')
            cpf.required = true;


        cnpj.addEventListener('change', function () {
            spaces = cnpj.value;
            if (!spaces.replace(/\s/g, '').length) {
                // string only contained whitespace (ie. spaces, tabs or line breaks)
                console.log('Entrou');
                spaces.trim();
                cnpj.required = true;
                console.log(spaces.length);
                cnpj.value = spaces.replace(/\s/g, '');
                cnpj.removeAttribute('value');
            }
        });

        cpf.addEventListener('change', function () {
            spaces = cpf.value;
            if (!spaces.replace(/\s/g, '').length) {
                // string only contained whitespace (ie. spaces, tabs or line breaks)
                console.log('Entrou');
                spaces.trim();
                cpf.required = true;
                console.log(spaces.length);
                cpf.value = spaces.replace(/\s/g, '');
                cpf.removeAttribute('value');

            }
        });

        legal_type.addEventListener("change", function () {

            if ($(this).prop('value') === 'J') {
                cnpj.required = true;
                div_cnpj.setAttribute('class', 'form-group');

                cpf.required = false;
                cpf.value = '';
                cpf.removeAttribute('value');
                div_cpf.setAttribute('class', 'form-group hidden');
                $('#cnpj_container').closest('.cnpj-display').css('display', 'block');
                $('#cpf_container').closest('.cpf-display').css('display', 'none');
            } else {
                cpf.required = true;
                div_cpf.setAttribute('class', 'form-group');
                cnpj.required = false;
                cnpj.value = '';
                cnpj.removeAttribute('value');
                div_cnpj.setAttribute('class', 'form-group hidden');
                $('#cnpj_container').closest('.cnpj-display').css('display', 'none');
                $('#cpf_container').closest('.cpf-display').css('display', 'block')
            }
        }, false);
    </script>

    {% if cpf_cnpj_invalid %}
        <script>
            $(document).ready(function () {
                alert("Enviado");

                if ($("#id_legal_type").val() === 'F')
                    document.getElementById("id_cpf").value = "{{ cpf_cnpj_invalid }}";


                else
                    document.getElementById("id_cnpj").value = "{{ cpf_cnpj_invalid }}";

            })
        </script>
    {% endif %}
{% endblock content %}
