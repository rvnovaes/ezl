{% extends 'inicial.html' %}
{% load render_table from django_tables2 %}
{% load static %}
{% load querystring from django_tables2 %}
{% block head %}
    {{ block.super }}
    {% block css_head %}
        {{ block.super }}
        <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css"
              rel="stylesheet"/>
    {% endblock %}
{% endblock %}
{% block content %}
    {{ block.super }}
    <div class="panel panel-primary">
        <div class="panel-heading">
            <h3 class="panel-title">Cadastre um novo escritório</h3>
        </div>
        <div class="panel-body">
            <form action="{% url 'office_add' %}" method="POST">
                {% csrf_token %}
                <div class="inputs">
                    <div class="row">
                        <div class="col-md-12">
                            <fieldset>
                                <legend>Dados do escritório</legend>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group label-static">
                                            <label for="name" class='control-label'>Razão
                                                Social</label>
                                            <input type='name' class='form-control' name='name'
                                                   value="{{ object.name }}" id="name">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group label-static">
                                            <label for="legal_name" class='control-label'>Nome
                                                fantasia</label>
                                            <input type='text' class='form-control'
                                                   name='legal_name' id="legal_name"
                                                   value="{{ object.legal_name }}">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group label-static">
                                            <label for="legal_type"
                                                   class='control-label'>Tipo</label>
                                            <select class="form-control" name="legal_type">
                                                <option value="F" {% if object.legal_type == 'F' %}
                                                        selected {% endif %}>Física
                                                </option>
                                                <option value="J" {% if object.legal_type == 'J' %}
                                                        selected {% endif %}>Jurídica
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group label-static">
                                            <label for="cpf_cnpj"
                                                   class='control-label'>CPF/CNPJ</label>
                                            <input type='text' class='form-control' name=cpf_cnpj
                                                   value={{ object.cpf_cnpj }}>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-2 col-md-offset-4">
                            <a class="btn btn-danger btn-block" href="{% url 'start_user' %}">Cancelar</a>
                        </div>
                        <div class="col-md-2">
                            <input type="submit" value="Salvar" class="btn btn-primary btn-block">
                        </div>
                    </div>
                </div>
                <ul class="nav nav-pills">
                    <li class="active"><a data-toggle="tab" href="#endereco">Endereços</a></li>
                    <li><a data-toggle="tab" href="#convites-usuarios">Convites para usuários</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div id="endereco" class="tab-pane fade in active">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" paginate-fixed>
                                {% block table.thead %}
                                    <thead>
                                    <tr>
                                        {% for column in table.columns %}
                                            {% if column.orderable %}
                                                <th {{ column.attrs.th.as_html }}><a
                                                        href="{% querystring table.prefixed_order_by_field=column.order_by_alias.next %}">{{ column.header|lower|capfirst }}</a>
                                                </th>
                                            {% else %}
                                                {% if not column.attrs.selectable == True %}
                                                    <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                                {% else %}
                                                    <th {{ column.attrs.th.as_html }}>{{ column.header }}</th>
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                    </thead>
                                {% endblock table.thead %}
                                {% block table.tbody %}
                                    <tbody>
                                    {% for row in table.page.object_list|default:table.rows %}
                                        {# support pagination #}
                                        {% block table.tbody.row %}
                                            <tr class="{% cycle "odd" "even" %}"
                                                data-href="{{ row.attrs.data_href }}">
                                                {% for column, cell in row.items %}
                                                    <td {{ column.attrs.td.as_html }}>{{ cell }}</td>
                                                {% endfor %}
                                            </tr>
                                        {% endblock table.tbody.row %}
                                    {% empty %}
                                        {% if table.empty_text %}
                                            {% block table.tbody.empty_text %}
                                                <tr>
                                                    <td colspan="{{ table.columns|length }}">{{ table.empty_text }}</td>
                                                </tr>
                                            {% endblock table.tbody.empty_text %}
                                        {% endif %}
                                    {% endfor %}
                                    </tbody>
                                {% endblock table.tbody %}
                                {% block table.tfoot %}
                                    <tfoot></tfoot>
                                {% endblock table.tfoot %}
                            </table>
                        </div>
                        <div class="text-right" style="">
                            <div class="fixed-btn">
                                <input type="button" data-toggle="modal"
                                       data-target="#confirmDelete" id="delete_button"
                                       class="btn btn-fab btn-warning material-icons"
                                       value="remove" disabled>
                                <a class="btn btn-fab btn-primary"
                                   href="{% url 'address_office_create' object.pk %}">
                                    <!-- style="height: 30px !important; width: 30px !important; min-width: 30px !important;"> -->
                                    <i class="material-icons">add</i></a>
                            </div>
                        </div>
                    </div>
                    <div id="convites-usuarios" class="tab-pane fade">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Usuário</th>
                                <th>Status</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for invite in object.invites.all %}
                                {% if invite.status != 'A' %}
                                    <tr>
                                        <td>{{ invite.person.name }}</td>
                                        <td>{{ invite.person.auth_user.username }}</td>
                                        {% if invite.status == 'N' %}
                                            <td>Enviado</td>
                                        {% else %}
                                            <td>Recusado</td>
                                        {% endif %}
                                    </tr>
                                {% endif %}
                            {% endfor %}
                            </tbody>
                        </table>
                        <div class="text-right" style="">
                            <div class="fixed-btn">
                                <input type="button" data-toggle="modal"
                                       data-target="#confirmDelete" id="delete_button"
                                       class="btn btn-fab btn-warning material-icons"
                                       value="remove" disabled>
                                <button type="button" class="btn btn-fab btn-primary"
                                        data-toggle="modal" data-target="#new_invite">
                                    <i class="material-icons">add</i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    {% include 'core/new_invite.html' with office=object.pk %}
{% endblock %}

{% block javascript %}
    {{ block.super }}
    {% block extrajs %}
        {{ block.super }}
        <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
    {% endblock %}
    <script>
        $(document).ready(function () {
            var elUsersToInvite = $('.users_to_invite');
            var data = {};
            $.ajax({
                type: 'GET',
                url: '/users_to_invite/',
                data: data,
                success: function (response) {
                    response.data.forEach(function (user) {
                        elUsersToInvite.append($('<option>', {
                            value: user.person__pk,
                            text: user.person__name + ' (' + user.username + ')'
                        }))
                    })
                }
            });
            elUsersToInvite.select2();
        });
    </script>
{% endblock %}
