{% extends "skeleton/forms/base.html" %}
{% load static %}
{% block content %}
<link href="{% static 'chat/css/chat.css' %}" rel="stylesheet">
<script src="{% static 'chat/vendor/angular/angular.js' %}"></script>
<script src="{% static 'chat/js/ng-chat-infinite-scroll.js' %}"></script>
<script src="{% static 'chat/vendor/angular-ui-event/dist/event.min.js' %}"></script>
<script src="{% static 'chat/js/app.js' %}"></script>
<script src="{% static 'chat/js/controllers/chatCtrl.js' %}"></script>
<script src="{% static 'chat/js/services/chatApiService.js'%}"></script>
<script src="{% static 'chat/js/directives/chatDirective.js'%}"></script>
{%verbatim%}
<section ng-app='app' ng-controller='chatCtrl'>
  <div class="chat-main">
    <div class="chat-main-box">
      <!-- .chat-left-panel -->
      <div class="chat-left-aside">
          <div class="open-panel"><i class="ti-angle-right"></i></div>
          <div class="chat-left-inner" style="height: 133px;">
            <div class="row">
              <div class="col-md-12">
                <button ng-if="!listOffices" ng-click="goToOfficeList()" class="btn btn-block btn-rounded btn-success">
                  <i class="fa fa-arrow-left"></i> Voltar
                </button>                
              </div>
            </div>
              <div class="form-material">
                <input class="form-control p-20" placeholder="Pesquisar..." type="text" ng-model="search"/>
                <div class="text-center" ng-show="!listOffices">
                <label>
                    <input type="checkbox" ng-model="hideEmptyChats">
                    <span>NÃ£o exibir chats vazios</span>
                  </label>
                </div>
              </div>
              <div>
                <ul class="chatonline style-none" style="overflow: hidden; width: auto; height: 100%;" ng-if="listOffices">
                  <div class="slimScroll">
                    <li class="list-chat" ng-repeat="contact in contacts" ng-click="getChats(contact.pk)">
                      <a class="chat-list-a" href="#" data-chat-label="{{chat.label}}">
                        <div>
                          <span class="label label-rouded label-primary pull-right hide" id="notify-1251" style="color:#fff"></span>
                            <div class="row">
                              <div class="col-md-2">
                                <div class="circle circle-sm bg-success di">
                                 <i class="fa fa-building-o"></i>
                                </div>
                              </div>
                              <div class="col-md-10 chat-title">
                                <span id="chat-title">
                                  {{contact.legal_name|uppercase}}
                                  <div class="row">

                                    <div class="col-md-12">
                                      <small class="label label-rouded label-warning pull-right" ng-if="contact.unread_message_quanty > 0">{{contact.unread_message_quanty}}</small>
                                    </div>
                                  </div>
                                </span>
                              </div>
                            </div>
                          </div>
                      </a>
                      </li>
                    </div>
                  </ul>
                 
                
                  <ul class="chatonline style-none" ng-show="!listOffices">
                      <div id="list-chat-scroll">
                         <div infinite-scroll='loadMoreChats()' infinite-scroll-distance='0'>
                          <li class="text-center" ng-show="chatsLoading">
                            Carregando...
                          </li>
                          <li class="list-chat" ng-repeat="chat in chats" ng-click="getMessages(chat)" scroll-bottom="scroll-bottom">
<a class="chat-list-a" href="#" data-chat-label="{{chat.label}}">
                            <div>
                              <span class="label label-rouded label-primary pull-right hide" id="notify-1251" style="color:#fff"></span>
                                <div class="row">
                                  <div class="col-md-2">
                                    <div class="circle circle-sm bg-info di">OS
                                    </div>
                                  </div>
                                  <div class="col-md-10 chat-title">
                                    <span id="chat-title">
                                      {{chat.title}}
                                      <div class="row">
                                        <div class="col-md-6">
                                          <small class="text-muted">
                                            <i class="fa fa-clock-o"></i>{{chat.alter_date|date:"dd/MM/yy HH:mm"}}
                                          </small>
                                        </div>
                                        <div class="col-md-6">
                                          <small class="label label-rouded label-warning pull-right" ng-if="chat.unread_message_quanty > 0">{{chat.unread_message_quanty}}</small>
                                        </div>
                                      </div>
                                    </span>
                                  </div>
                                </div>
                              </div>
                          </a>
                          <hr/>                        
                        </li>
                      </div>
                      </div>
                  </ul>
              <div class="slimScrollBar" style="background: rgb(220, 220, 220) none repeat scroll 0% 0%; width: 0px; position: absolute; top: 0px; opacity: 0.4; display: none; border-radius: 7px; z-index: 99; right: 1px; height: 30px;"></div><div class="slimScrollRail" style="width: 0px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; background: rgb(51, 51, 51) none repeat scroll 0% 0%; opacity: 0.2; z-index: 90; right: 1px;">
              </div>
            </div>
          </div>
      </div>
      <!-- .chat-left-panel -->
      <!-- .chat-right-panel -->
      <div class="chat-right-aside" ng-show="inMessage">
          <div class="chat-main-header">
              <div class="p-10 b-b">
                  <div class="row">
                    <div class="col-md-10">
                      <h3 class="box-title">{{chat.title}}</h3>
                      <span class="heading-description text-wrap">{{ chat.description }}</span>
                    </div>
                    <div class="col-md-2" ng-if="!existsUnread">
                      <button class="btn btn-primary btn-outline" ng-click="unreadMessage(chat)">
                        <i class="mdi mdi-eye-off"></i>
                      </button>
                    </div>
                  </div>
              </div>
          </div>
          <div class="chat-box">
            <ul id="scroll-bottom" ui-event="{ change: 'onChangeMessage($event)' }" class="chat-list slimscroll p-t-30">
              <div class="slimscroll">
                <li ng-repeat="message in messages.messages" ng-class="getClass(message.create_user_id, messages.request_user_id)">
                  <div class="chat-image">
                    <div class="circle circle-sm bg-info di">
                      <i class="fa fa-user"></i>
                    </div>
                  </div>
                  <div class="chat-body">
                    <div class="chat-text">
                      <h4>{{message.create_user__username}}</h4>
                      <p>{{message.message}}</p> <b>{{message.create_date | date: "dd/MM/yyyy HH:mm:ss"}}</b>
                    </div>
                  </div>
                </li>
              </div>
            </ul>
          </div>
          <div class="send-chat-box">
              <div class="input-message">
                  <input class="form-control" placeholder="Digite sua mensagem" id="inputMsg" ng-model="message" ui-event="{ keypress: 'onEnterKey($event)' }">
                  <div class="custom-send p-r-10 p-b-10">
                      <button class="btn btn-success btn-lg btn-circle" type="button" ng-click="sendMessage()" id="btnSend" scroll-bottom="scroll-bottom">
                          <i class="fa fa-paper-plane-o"></i></button>
                  </div>
              </div>
          </div>
      </div>                    <!-- .chat-right-panel -->
    </div>
  </div>
</section>
{%endverbatim%}
<script src="{% static 'skeleton/js/chat.js' %}"></script>
{% endblock %}
