{% extends 'inicial.html' %}

{% load core_filters %}
{% load staticfiles %}

{% block javascript %}
    {{ block.super }}
    <script src="{% static "ajaxuploader/js/fileuploader.js" %}"></script>
    <script src="{% static "file_form/file_form.js" %}"></script>
    <script>
       $(function() {
           initUploadFields($('#task_form'));
       });
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/vue/2.5.2/vue.min.js"></script>
    <script src="{% static 'task/task-builk-create.js' %}"></script>
    {% endblock %}

{% block extra_head %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static "fileuploader.css" %}">
    <style type="text/css">
        .select2{
            margin-top: 20px !important;
        }
        label{
            width: 100%;
        }
        .modal-dialog {
            width: 90%
        }
    </style>

    <link href="/static/autocomplete_light/vendor/select2/dist/css/select2.css" type="text/css" media="all" rel="stylesheet" />
    <link href="/static/autocomplete_light/select2.css" type="text/css" media="all" rel="stylesheet" />
    <script type="text/javascript" src="/static/autocomplete_light/jquery.init.js"></script>
    <script type="text/javascript" src="/static/autocomplete_light/autocomplete.init.js"></script>
    <script type="text/javascript" src="/static/autocomplete_light/vendor/select2/dist/js/select2.full.js"></script>
    <script type="text/javascript" src="/static/autocomplete_light/vendor/select2/dist/js/i18n/pt-BR.js"></script>
    <script type="text/javascript" src="/static/libs/django-autocomplete-light-3.2.9/select2.js"></script>
{% endblock %}

{% block content %}
    {% include 'core/widgets/messages.html' %}
    <form id="task_form" action="" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ formset.management_form }}
            <div class="form-row">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h1 class="panel-title">Criar ordem de serviço</h1>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="form-group col-sm-3">
                                <label>
                                    <span>Número da pasta / Cliente*</span>
                                    <select
                                        name="folder"
                                        class="form-control"
                                        id="id_folder"
                                        data-autocomplete-light-language="pt-BR"
                                        data-minimum-input-length="3"
                                        data-autocomplete-light-url="{% url 'folder_autocomplete' %}"
                                        data-autocomplete-light-function="select2">
                                            <option value="">Selecione...</option>
                                    </select>
                                </label>
                            </div>
                            <div class="form-group col-sm-1">
                                <button id="btn_add_folder"
                                        type="button"
                                        class="btn btn-sm btn-raised btn-primary pull-left"
                                        title="Adicionar nova pasta">
                                    <i class="material-icons left">add</i>
                                </button>
                            </div>
                            <div class="form-group col-sm-3">
                                <label>
                                    Número do processo*
                                    <select name="lawsuit"
                                        class="form-control"
                                        id="id_lawsuit">
                                            <option value="">Selecione a pasta</option>
                                    </select>
                                </label>
                            </div>
                            <div class="form-group col-sm-1">
                                <button id="btn_add_lawsuit"
                                        type="button"
                                        class="btn btn-sm btn-raised btn-primary pull-left disabled-btn"
                                        title="Adicionar novo processo">
                                    <i class="material-icons left">add</i>
                                </button>
                            </div>
                            <div class="form-group col-sm-3">
                                <label>
                                    Tipo de movimentação*
                                    <select name="movement"
                                        class="form-control"
                                        required
                                        id="id_movement">
                                            <option value="">Selecione o processo</option>
                                    </select>
                                </label>
                            </div>
                            <div class="form-group col-sm-1">
                                <button id="btn_add_movement"
                                        type="button"
                                        class="btn btn-sm btn-raised btn-primary pull-left disabled-btn"
                                        title="Adicionar nova movimentação">
                                    <i class="material-icons left">add</i>
                                </button>
                            </div>
                        </div>
                        {% verbatim %}
                        <div class="form-row">
                            <div class="panel panel-primary">
                                <div class="panel-heading">
                                    <h1 class="panel-title">Providências</h1>
                                </div>
                                <div class="panel-body">
                                    <table class="table" id="app_task_list">
                                        <thead>
                                            <tr>
                                                <th>Status</th>
                                                <th>N° da OS</th>
                                                <th>Tipo de serviço</th>
                                                <th>Correspondente</th>
                                                <th>Solicitante</th>
                                                <th>Prazo</th>
                                                <th>Data delegação</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="(task, i) in tasks" v-bind:data-href="task.url">
                                                <td>{{ task.status }}</td>
                                                <td>{{ task.task_number }}</td>
                                                <td>{{ task.type_task.name }}</td>
                                                <td>{{ task.person_executed_by.name }}</td>
                                                <td>{{ task.person_asked_by.name }}</td>
                                                <td>{{ task.final_deadline_date }}</td>
                                                <td>{{ task.delegation_date }}</td>
                                            </tr>
                                            <tr v-if="tasks.length == 0">
                                                <td class="text-center" colspan="7">Nenhuma OS para exibir</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        {% endverbatim %}        
                        <div id="form-content" class="modal">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content ">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                        <h4 class="modal-title">Cadastrar providência</h4>
                                    </div>
                                    <div class="modal-body">
                                        <div class="form-row">
                                            <div class="panel panel-primary">
                                                <div class="panel-body">
                                                    {% for field in form %}
                                                        {% if field.name != 'documents' %}
                                                            <div class="form-group col-sm-3">
                                                                <label>
                                                                    {{ field | append_ast_if_req | label_capitalizer}}{{ field }}
                                                                </label>
                                                            </div>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="panel panel-primary">
                                                <div class="panel-heading">
                                                    <h1 class="panel-title">Anexos</h1>
                                                </div>
                                                <div class="panel-body">
                                                    <fieldset>

                                                        {{ form.documents }}

                                                        {% include 'django_file_form/upload_template.html' %}
                                                    </fieldset>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-row  text-center">
                                            <button type="submit" class="btn btn-sm btn-raised btn-primary"><i
                                                    class="material-icons left">done</i>
                                                Salvar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        <div class="text-right hide" style="margin: auto" id="btn_add">
            <div class="fixed-btn">
                <a class="btn btn-fab btn-primary" href="#" data-toggle="modal" data-target="#form-content">
                    <i class="material-icons">add</i>
                <div class="ripple-container"></div></a>
            </div>
        </div>

    </form>

{% endblock content %}
